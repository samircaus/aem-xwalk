/**
 * Copyright 2019 Adobe. All rights reserved.
 * This file is licensed to you under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS
 * OF ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 */

!function(){"use strict";var e=e=>null==e,t=t=>!e(t)&&!Array.isArray(t)&&"object"==typeof t;
/*! js-cookie v3.0.5 | MIT */
function n(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}var o=function e(t,o){function r(e,r,s){if("undefined"!=typeof document){"number"==typeof(s=n({},o,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in s)s[a]&&(i+="; "+a,!0!==s[a]&&(i+="="+s[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+i}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],o={},r=0;r<n.length;r++){var s=n[r].split("="),i=s.slice(1).join("=");try{var a=decodeURIComponent(s[0]);if(o[a]=t.read(i,a),e===a)break}catch(e){}}return e?o[e]:o}},remove:function(e,t){r(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(o)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),r={get:o.get.bind(o),set:o.set.bind(o),remove:o.remove.bind(o),withConverter:o.withConverter.bind(o)};const s=(e,n)=>{Object.keys(n).forEach((o=>{t(e[o])&&t(n[o])?s(e[o],n[o]):e[o]=n[o]}))};var i=(t,...n)=>{if(e(t))throw new TypeError('deepAssign "target" cannot be null or undefined');const o=Object(t);return n.forEach((e=>s(o,Object(e)))),o},a=(e,t)=>n=>{const o=t.split(".").reduce(((e,t)=>(e[t]=e[t]||{},e[t])),e);i(o,n)},c=()=>{const e=[];return{add(t){e.push(t)},call:(...t)=>Promise.all(e.map((e=>e(...t))))}},d=({logger:e,cookieJar:t})=>({...t,set(n,o,r){e.info("Setting cookie",{name:n,value:o,...r}),t.set(n,o,r)}}),l=()=>{const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e};const u=(e,t)=>e===t;var g=(e,t)=>e.appendChild(t);var p=(e,n={},o={},r=[],s=document)=>{const i=s.createElement(e);return Object.keys(n).forEach((e=>{i.setAttribute(e,n[e])})),((e,n)=>{Object.keys(n).forEach((o=>{if("style"===o&&t(n[o])){const t=n[o];Object.keys(t).forEach((n=>{e.style[n]=t[n]}))}else e[o]=n[o]}))})(i,o),r.forEach((e=>g(i,e))),i};const m="IMG",f="STYLE",h="SCRIPT";var y=({src:e,currentDocument:t=document})=>new Promise(((n,o)=>{p(m,{src:e},{onload:n,onerror:o,onabort:o},[],t)})),w=e=>"function"==typeof e,v=e=>Array.isArray(e)&&e.length>0,b=e=>Array.isArray(e)?e:null==e?[]:[].slice.call(e);const C=/^\s*>/;var I=(e,t)=>C.test(t)?b(e.querySelectorAll(":scope "+t)):b(e.querySelectorAll(t)),E=":shadow";const k=(e,t)=>{const n=t;if(!n.startsWith(">"))return n;return(e instanceof Element||e instanceof Document?":scope":":host")+" "+n};var P=(e,t)=>{const n=(e=>e.split(E))(t);if(n.length<2)return I(e,t);let o=e;for(let e=0;e<n.length;e+=1){const t=n[e].trim();if(""===t&&o.shadowRoot){o=o.shadowRoot;continue}const r=k(o,t),s=I(o,r);if(0===s.length||!s[0]||!s[0].shadowRoot)return s;o=s[0].shadowRoot}},R=(e,t=document)=>-1===e.indexOf(E)?I(t,e):P(t,e);const D="MutationObserver",S={childList:!0,subtree:!0},O=e=>new Error("Could not find: "+e),T=e=>new Promise(e);var N=(e,t=R,n=5e3,o=window,r=document)=>{const s=t(e);return v(s)?Promise.resolve(s):(e=>w(e[D]))(o)?((e,t,n,o,r)=>T(((s,i)=>{let a;const c=new e[D]((()=>{const e=r(n);v(e)&&(c.disconnect(),a&&clearTimeout(a),s(e))}));a=setTimeout((()=>{c.disconnect(),i(O(n))}),o),c.observe(t,S)})))(o,r,e,n,t):(e=>"visible"===e.visibilityState)(r)?((e,t,n,o)=>T(((r,s)=>{const i=()=>{const n=o(t);v(n)?r(n):e.requestAnimationFrame(i)};i(),setTimeout((()=>{s(O(t))}),n)})))(o,e,n,t):((e,t,n)=>T(((o,r)=>{const s=()=>{const t=n(e);v(t)?o(t):setTimeout(s,100)};s(),setTimeout((()=>{r(O(e))}),t)})))(e,n,t)},q=e=>{const t=e.parentNode;return t?t.removeChild(e):null};const x={name:"Adobe Alloy"},M={style:{display:"none",width:0,height:0}};var A=e=>t(e)&&0===Object.keys(e).length;const U=(n,o)=>e(n)||!t(n)?n:Object.keys(n).reduce(((e,r)=>{const s=n[r];if(t(s)){const t=U(s,o);return A(t)?e:{...e,[r]:t}}return o(s)?{...e,[r]:s}:e}),{});var L="com.adobe.alloy.";const j=L+"getTld";var B="kndctr",F=e=>e.replace("@","_"),V=(e,t)=>B+"_"+F(e)+"_"+t,z=(e,t)=>{const n={};return e.forEach((e=>{const o=t(e);n[o]||(n[o]=[]),n[o].push(e)})),n};const H="Chrome",_="Edge",J="EdgeChromium",Q="Firefox",G="IE",W="Safari",X="Unknown";var Y=e=>{let t,n=!1;return()=>(n||(n=!0,t=e()),t)};const $=[H,_,J,"IE",X];const K=(e,t,n)=>({getItem(o){try{return e[t].getItem(n+o)}catch{return null}},setItem(o,r){try{return e[t].setItem(n+o,r),!0}catch{return!1}},clear(){try{return Object.keys(e[t]).forEach((o=>{o.startsWith(n)&&e[t].removeItem(o)})),!0}catch{return!1}}});var Z,ee,te=e=>"boolean"==typeof e,ne=e=>"number"==typeof e&&!Number.isNaN(e),oe=e=>{const t=parseInt(e,10);return ne(t)&&e===t},re=e=>"string"==typeof e,se=e=>re(e)&&e.length>0,ie=()=>{};function ae(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ce=(ee||(ee=1,Z={parse:function(e){return function(e){var t={};if(!e||"string"!=typeof e)return t;var n=e.trim().replace(/^[?#&]/,""),o=new URLSearchParams(n),r=o.keys();do{var s=r.next(),i=s.value;if(i){var a=o.getAll(i);1===a.length?t[i]=a[0]:t[i]=a}}while(!1===s.done);return t}(e)},stringify:function(e){return function(e){var t="{{space}}",n=new URLSearchParams;return Object.keys(e).forEach((function(o){var r=e[o];"string"==typeof e[o]?r=r.replace(/ /g,t):["object","undefined"].includes(typeof r)&&!Array.isArray(r)&&(r=""),Array.isArray(r)?r.forEach((function(e){n.append(o,e)})):n.append(o,r)})),n.toString().replace(new RegExp(encodeURIComponent(t),"g"),"%20")}(e)}}),Z),de=ae(ce),le=e=>e instanceof Error?e:new Error(e),ue=({error:e,message:t})=>{try{e.message=t}catch{}},ge=({error:e,message:t})=>{const n=le(e),o=t+"\nCaused by: "+n.message;return ue({error:n,message:o}),n},pe=(e,t)=>{if(ne(e)||re(e)){const t=Math.round(Number(e));if(!Number.isNaN(t))return t}return t};const me=(e,t,n)=>(""+e).padStart(t,n);const fe=[];for(let e=0;e<256;++e)fe.push((e+256).toString(16).slice(1));let he;const ye=new Uint8Array(16);var we={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ve(e,t,n){if(we.randomUUID&&!e)return we.randomUUID();const o=(e=e||{}).random??e.rng?.()??function(){if(!he){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");he=crypto.getRandomValues.bind(crypto)}return he(ye)}();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=15&o[6]|64,o[8]=63&o[8]|128,function(e,t=0){return(fe[e[t+0]]+fe[e[t+1]]+fe[e[t+2]]+fe[e[t+3]]+"-"+fe[e[t+4]]+fe[e[t+5]]+"-"+fe[e[t+6]]+fe[e[t+7]]+"-"+fe[e[t+8]]+fe[e[t+9]]+"-"+fe[e[t+10]]+fe[e[t+11]]+fe[e[t+12]]+fe[e[t+13]]+fe[e[t+14]]+fe[e[t+15]]).toLowerCase()}(o)}const be=e=>function(t,n){return null==t?t:e.call(this,t,n)},Ce=(e,t)=>function(n,o){return t.call(this,e.call(this,n,o),o)},Ie=(e,t)=>function(n,o){const r=[],s=[e,t].reduce(((e,t)=>{try{return t.call(this,e,o)}catch(t){return r.push(t),e}}),n);if(r.length)throw new Error(r.join("\n"));return s},Ee=(e,t,n)=>Object.assign(Ce(e,t),e,n),ke=(e,t,n)=>Object.assign(Ce(e,be(t)),e,n),Pe=(e,t,n,o)=>{if(!e)throw new Error("'"+n+"': Expected "+o+", but got "+JSON.stringify(t)+".")};var Re=(e,t)=>(Pe(te(e),e,t,"true or false"),e),De=(e,t)=>(Pe(w(e),e,t,"a function"),e),Se=(e,t)=>function(n,o){let r;const s=e.find((e=>{try{return r=e.call(this,n,o),!0}catch{return!1}}));return Pe(s,n,o,t),r},Oe=e=>function(t,n){Pe(Array.isArray(t),t,n,"an array");const o=[],r=t.map(((r,s)=>{try{return e.call(this,r,n+"["+s+"]",t)}catch(e){return void o.push(e.message)}}));if(o.length)throw new Error(o.join("\n"));return r},Te=(e="This field has been deprecated")=>function(t,n){let o=e;return void 0!==t&&(n&&(o="'"+n+"': "+o),this&&this.logger&&this.logger.warn(o)),t},Ne=e=>function(n,o){Pe(t(n),n,o,"an object");const r=[],s={};if(Object.keys(n).forEach((t=>{const i=n[t],a=o?o+"."+t:t;try{const n=e.call(this,i,a);void 0!==n&&(s[t]=n)}catch(e){r.push(e.message)}})),r.length)throw new Error(r.join("\n"));return s},qe=(e,t)=>(n,o)=>(Pe(n>=t,n,o,e+" greater than or equal to "+t),n),xe=e=>(n,o)=>(t(n)?Pe(!A(n),n,o,e):Pe(n.length>0,n,o,e),n),Me=e=>function(n,o){Pe(t(n),n,o,"an object");const r=[],s={};if(Object.keys(e).forEach((t=>{const i=n[t],a=e[t],c=o?o+"."+t:t;try{const e=a.call(this,i,c);void 0!==e&&(s[t]=e)}catch(e){r.push(e.message)}})),Object.keys(n).forEach((e=>{Object.prototype.hasOwnProperty.call(s,e)||(s[e]=n[e])})),r.length)throw new Error(r.join("\n"));return s},Ae=(e,n,o)=>function(r,s){Pe(t(r),r,s,"an object");const{[e]:i,[o]:a,...c}=r,d=n(i,s);if(void 0!==d){let t="The field '"+e+"' is deprecated. Use '"+o+"' instead.";if(s&&(t="'"+s+"': "+t),void 0!==a&&a!==d)throw new Error(t);this&&this.logger&&this.logger.warn(t)}return{[o]:a||d,...c}},Ue=()=>(e,t)=>(Pe((e=>{const t=Object.create(null);for(let n=0;n<e.length;n+=1){const o=e[n];if(o in t)return!1;t[o]=!0}return!0})(e),e,t,"array values to be unique"),e);const Le=/^[a-z0-9.-]{1,}$/i;var je=(e,t)=>(Pe(Le.test(e),e,t,"a valid domain"),e),Be=(e,t)=>(Pe(oe(e),e,t,"an integer"),e),Fe=(e,t)=>(Pe(ne(e),e,t,"a number"),e),Ve=(e,t)=>(Pe((e=>{try{return null!==RegExp(e)}catch{return!1}})(e),e,t,"a regular expression"),e),ze=(e,t)=>{if(null==e)throw new Error("'"+t+"' is a required option");return e},He=(e,t)=>(Pe(re(e),e,t,"a string"),e);const _e=e=>e;_e.default=function(e){return Ee(this,(e=>t=>null==t?e:t)(e))},_e.required=function(){return Ee(this,ze)},_e.deprecated=function(e){return Ee(this,Te(e))};const Je=function(){return ke(this,je)},Qe=function(e){return ke(this,qe("an integer",e))},Ge=function(e){return ke(this,qe("a number",e))},We=function(e){return ke(this,(t="a number",n=e,(e,o)=>(Pe(e<=n,e,o,t+" less than or equal to "+n),e)));var t,n},Xe=function(){return ke(this,Be,{minimum:Qe})},Ye=function(){return ke(this,xe("a non-empty string"))},$e=function(){return ke(this,xe("a non-empty array"))},Ke=function(){return ke(this,xe("a non-empty object"))},Ze=function(){return ke(this,Ve)},et=function(e){return ke(this,(e=>(t,n)=>(Pe(e.test(t),t,n,"does not match the "+e.toString()),t))(e))},tt=function(){return ke(this,(()=>{const e=[];return(t,n)=>(Pe(-1===e.indexOf(t),t,n,"a unique value across instances"),e.push(t),t)})())},nt=function(){return ke(this,Ue())},ot=e=>({noUnknownFields:function(){return ke(this,(e=>(t,n)=>{const o=[];if(Object.keys(t).forEach((t=>{if(!e[t]){const e=n?n+"."+t:t;o.push("'"+e+"': Unknown field.")}})),o.length)throw new Error(o.join("\n"));return t})(e))},nonEmpty:Ke,concat:function(t){const n={...e,...t.schema};return ke(this,t,ot(n))},renamed:function(e,t,n){return o=this,r=Ae(e,t,n),Object.assign(Ie(be(r),o),o,s);var o,r,s},schema:e}),rt=function(e,t){return Ee(this,Se(e,t))}.bind(_e),st=function(){return this}.bind(_e),it=function(e){return ke(this,Oe(e),{nonEmpty:$e,uniqueItems:nt})}.bind(_e),at=function(){return ke(this,Re)}.bind(_e),ct=function(){return ke(this,De)}.bind(_e),dt=function(e){return ke(this,(e=>(t,n)=>(Pe(t===e,t,n,""+e),t))(e))}.bind(_e),lt=function(){return ke(this,Fe,{minimum:Ge,maximum:We,integer:Xe,unique:tt})}.bind(_e),ut=function(e){return ke(this,Ne(e),{nonEmpty:Ke})}.bind(_e),gt=function(e){return ke(this,Me(e),ot(e))}.bind(_e),pt=function(){return ke(this,He,{regexp:Ze,domain:Je,nonEmpty:Ye,unique:tt,matches:et})}.bind(_e),mt=function(...e){return rt(e.map(dt),"one of these values: "+JSON.stringify(e))};var ft=ut(it(gt({authenticatedState:mt("ambiguous","authenticated","loggedOut"),id:pt(),namespace:gt({code:pt()}).noUnknownFields(),primary:at(),xid:pt()}).noUnknownFields()).required()),ht=gt({}),yt="alloy_debug",wt=({console:e,locationSearch:t,createLogger:n,instanceName:o,createNamespacedStorage:r,getMonitors:s})=>{const i=de.parse(t),a=r("instance."+o+"."),c=a.session.getItem("debug");let d="true"===c,l=null===c;const u=()=>d,g=(e,{fromConfig:t})=>{t&&!l||(d=e),t||(a.session.setItem("debug",e.toString()),l=!1)};var p;return void 0!==i[yt]&&g((p=i[yt],re(p)&&"true"===p.toLowerCase()),{fromConfig:!1}),{setDebugEnabled:g,logger:n({getDebugEnabled:u,context:{instanceName:o},getMonitors:s,console:e}),createComponentLogger:t=>n({getDebugEnabled:u,context:{instanceName:o,componentName:t},getMonitors:s,console:e})}};const vt=["onComponentsRegistered","onBeforeEvent","onBeforeRequest","onResponse","onRequestFailure","onClick","onDecision"];var bt=e=>vt.reduce(((t,n)=>{var o;return t[n]=(o=((e,t)=>(...n)=>Promise.all(e.getLifecycleCallbacks(t).map((e=>new Promise((t=>{t(e(...n))}))))))(e,n),(...e)=>Promise.resolve().then((()=>o(...e)))),t}),{});const Ct=(e,t)=>(...n)=>{let o;try{o=e(...n)}catch(e){throw ge({error:e,message:t})}return o instanceof Promise&&(o=o.catch((e=>{throw ge({error:e,message:t})}))),o};var It=()=>{const e={},t={},n={};return{register(o,r){const{commands:s,lifecycle:i}=r;((e,n={})=>{const o=(r=Object.keys(t),s=Object.keys(n),r.filter((e=>s.includes(e))));var r,s;if(o.length)throw new Error("[ComponentRegistry] Could not register "+e+" because it has existing command(s): "+o.join(","));Object.keys(n).forEach((o=>{const r=n[o];r.commandName=o,r.run=Ct(r.run,"["+e+"] An error occurred while executing the "+o+" command."),t[o]=r}))})(o,s),((e,t={})=>{Object.keys(t).forEach((o=>{n[o]=n[o]||[],n[o].push(Ct(t[o],"["+e+"] An error occurred while executing the "+o+" lifecycle hook."))}))})(o,i),e[o]=r},getCommand:e=>t[e],getCommandNames:()=>Object.keys(t),getLifecycleCallbacks:e=>n[e]||[],getComponentNames:()=>Object.keys(e)}};const Et="in",kt="out",Pt="pending",Rt="general",Dt="declinedConsent",St="default",Ot="initial",Tt="new",Nt=e=>{const t=new Error(e);return t.code=Dt,t.message=e,t};var qt=({logger:e})=>{const t=[],n=()=>Promise.resolve(),o=()=>Promise.resolve(),r=()=>Promise.reject(Nt("No consent preferences have been set.")),s=()=>Promise.reject(Nt("The user declined consent.")),i=e=>{if(e)return Promise.reject(new Error("Consent is pending."));const n=l();return t.push(n),n.promise};return{in(r){r===St?this.awaitConsent=n:(r===Ot?e.info("Loaded user consent preferences. The user previously consented."):r===Tt&&this.awaitConsent!==o&&e.info("User consented."),(()=>{for(;t.length;)t.shift().resolve()})(),this.awaitConsent=o)},out(n){n===St?(e.warn("User consent preferences not found. Default consent of out will be used."),this.awaitConsent=r):(n===Ot?e.warn("Loaded user consent preferences. The user previously declined consent."):n===Tt&&this.awaitConsent!==s&&e.warn("User declined consent."),(()=>{for(;t.length;)t.shift().reject(Nt("The user declined consent."))})(),this.awaitConsent=s)},pending(t){t===St&&e.info("User consent preferences not found. Default consent of pending will be used. Some commands may be delayed."),this.awaitConsent=i},awaitConsent:()=>Promise.resolve(),withConsent(){return this.awaitConsent(!0)},current(){switch(this.awaitConsent){case n:return{state:"in",wasSet:!1};case o:return{state:"in",wasSet:!0};case r:return{state:"out",wasSet:!1};case s:return{state:"out",wasSet:!0};case i:return{state:"pending",wasSet:!1};default:return{state:"in",wasSet:!1}}}}};const xt=e=>e&&e._experience&&e._experience.decisioning&&v(e._experience.decisioning.propositions)?e._experience.decisioning.propositions:[];var Mt=()=>{const e={};let t,n,o=!1,r=!1,s=!0;const a=e=>{if(r)throw new Error(e+" cannot be called after event is finalized.")},c={hasQuery(){return Object.prototype.hasOwnProperty.call(this.getContent(),"query")},getContent(){const o=JSON.parse(JSON.stringify(e));return t&&i(o,{xdm:t}),n&&i(o,{data:n}),o},setUserXdm(e){a("setUserXdm"),t=e},setUserData(e){a("setUserData"),n=e},mergeXdm(t){a("mergeXdm"),t&&i(e,{xdm:t})},mergeData(t){a("mergeData"),t&&i(e,{data:t})},mergeMeta(t){a("mergeMeta"),t&&i(e,{meta:t})},mergeQuery(t){a("mergeQuery"),t&&i(e,{query:t})},documentMayUnload(){o=!0},finalize(o){if(r)return;const i=((e,t=u)=>e.filter(((n,o)=>((e,t,n)=>{for(let o=0;o<e.length;o+=1)if(n(e[o],t))return o;return-1})(e,n,t)===o)))([...xt(t),...xt(e.xdm)],((e,t)=>e===t||e.id&&t.id&&e.id===t.id&&e.scope&&t.scope&&e.scope===t.scope));if(t&&this.mergeXdm(t),i.length>0&&(e.xdm._experience.decisioning.propositions=i),n&&c.mergeData(n),r=!0,o){s=!1;const t={xdm:e.xdm||{},data:e.data||{}},n=o(t);s=!1!==n,e.xdm=t.xdm||{},e.data=t.data||{},A(e.xdm)&&delete e.xdm,A(e.data)&&delete e.data}},getDocumentMayUnload:()=>o,isEmpty:()=>A(e)&&(!t||A(t))&&(!n||A(n)),shouldSend:()=>s,getViewName(){if(t&&t.web&&t.web.webPageDetails)return t.web.webPageDetails.viewName},toJSON(){if(!r)throw new Error("toJSON called before finalize");return e}};return c};const At="configure",Ut="setDebug";var Lt=({logger:e,configureCommand:n,setDebugCommand:o,handleError:r,validateCommandOptions:s})=>{let i;return(a,c={})=>new Promise((t=>{const r=((t,r)=>{let a;if(t===At){if(i)throw new Error("The library has already been configured and may only be configured once.");a=()=>(i=n(r),i.then((()=>{})))}else{if(!i)throw new Error("The library must be configured first. Please do so by executing the configure command.");a=t===Ut?()=>{const e=gt({enabled:at().required()}).noUnknownFields(),t=s({command:{commandName:Ut,optionsValidator:e},options:r});o(t)}:()=>i.then((e=>{const n=e.getCommand(t);if(!n||!w(n.run)){const n=[At,Ut].concat(e.getCommandNames()).join(", ");throw new Error("The "+t+" command does not exist. List of available commands: "+n+".")}const o=s({command:n,options:r});return n.run(o)}),(()=>(e.warn("An error during configuration is preventing the "+t+" command from executing."),new Promise((()=>{})))))}return a})(a,c);e.logOnBeforeCommand({commandName:a,options:c}),t(r())})).catch((e=>r(e,a+" command"))).catch((t=>{throw e.logOnCommandRejected({commandName:a,options:c,error:t}),t})).then((n=>{const o=t(n)?n:{};return e.logOnCommandResolved({commandName:a,options:c,result:o}),o}))};const jt="https://adobe.ly/3sHgQHb";var Bt=({command:e,options:t})=>{const{commandName:n,documentationUri:o=jt,optionsValidator:r}=e;let s=t;if(r)try{s=r(t)}catch(e){throw new Error("Invalid "+n+" command options:\n\t - "+e+" For command documentation see: "+o)}return s};var Ft=({options:e,componentCreators:t,coreConfigValidators:n,createConfig:o,logger:r,setDebugEnabled:s})=>{const i=(e=>{const t=[],n={get enabled(){return e.enabled},flush(){t.forEach((({method:t,args:n})=>e[t](...n)))}};return Object.keys(e).filter((t=>"function"==typeof e[t])).forEach((e=>{n[e]=(...n)=>{t.push({method:e,args:n})}})),n})(r),a=t.map((({configValidators:e})=>e)).filter((e=>e)).reduce(((e,t)=>e.concat(t)),n),c=o((({combinedConfigValidator:e,options:t,logger:n})=>{try{return e.noUnknownFields().required().call({logger:n},t)}catch(e){throw new Error("Resolve these configuration problems:\n\t - "+e.message.split("\n").join("\n\t - ")+"\nFor configuration documentation see: https://adobe.ly/3sHh553")}})({combinedConfigValidator:a,options:e,logger:i}));s(c.debugEnabled,{fromConfig:!0}),i.flush();const d=((e,t,n)=>n.reduce(((n,{buildOnInstanceConfiguredExtraParams:o})=>(o&&(n={...n,...o({config:e,logger:t})}),n)),{}))(c,r,t);return r.logOnInstanceConfigured({...d,config:c}),c};const Vt=e=>({...e});var zt=({errorPrefix:e,logger:t})=>(n,o)=>{const r=le(n);if(r.code===Dt)return t.warn("The "+o+" could not fully complete. "+r.message),{};throw ue({error:r,message:e+" "+r.message}),r},Ht=({getDebugEnabled:e,console:t,getMonitors:n,context:o})=>{let r="["+o.instanceName+"]";o.componentName&&(r+=" ["+o.componentName+"]");const s=(e,t)=>{const r=n();if(r.length>0){const n={...o,...t};r.forEach((t=>{t[e]&&t[e](n)}))}},i=(n,...o)=>{s("onBeforeLog",{level:n,arguments:o}),e()&&t[n](r,...o)};return{get enabled(){return n().length>0||e()},logOnInstanceCreated(e){s("onInstanceCreated",e),i("info","Instance initialized.")},logOnInstanceConfigured(e){s("onInstanceConfigured",e),i("info","Instance configured. Computed configuration:",e.config)},logOnBeforeCommand(e){s("onBeforeCommand",e),i("info","Executing "+e.commandName+" command. Options:",e.options)},logOnCommandResolved(e){s("onCommandResolved",e),i("info",e.commandName+" command resolved. Result:",e.result)},logOnCommandRejected(e){s("onCommandRejected",e),i("error",e.commandName+" command was rejected. Error:",e.error)},logOnBeforeNetworkRequest(e){s("onBeforeNetworkRequest",e),i("info","Request "+e.requestId+": Sending request.",e.payload)},logOnNetworkResponse(e){s("onNetworkResponse",e);const t=e.parsedBody||e.body?"response body:":"no response body.";i("info","Request "+e.requestId+": Received response with status code "+e.statusCode+" and "+t,e.parsedBody||e.body)},logOnNetworkError(e){s("onNetworkError",e),i("error","Request "+e.requestId+": Network request failed.",e.error)},logOnContentHiding(e){s("onContentHiding",{status:e.status}),i(e.logLevel,e.message)},logOnContentRendering(e){s("onContentRendering",{status:e.status,payload:e.detail}),i(e.logLevel,e.message)},info:i.bind(null,"info"),warn:i.bind(null,"warn"),error:i.bind(null,"error")}},_t="__view__",Jt=e=>(t,n)=>{e.xdm=e.xdm||{},e.xdm.identityMap=e.xdm.identityMap||{},e.xdm.identityMap[t]=e.xdm.identityMap[t]||[],e.xdm.identityMap[t].push(n)},Qt=e=>{const{payload:t,getAction:n,getUseSendBeacon:o,datastreamIdOverride:r,edgeSubPath:s}=e,i=ve();let a=!1,c=!1;return{getId:()=>i,getPayload:()=>t,getAction:()=>n({isIdentityEstablished:c}),getDatastreamIdOverride:()=>r,getUseSendBeacon:()=>o({isIdentityEstablished:c}),getEdgeSubPath:()=>s||"",getUseIdThirdPartyDomain:()=>a,setUseIdThirdPartyDomain(){a=!0},setIsIdentityEstablished(){c=!0}}},Gt=({payload:e,datastreamIdOverride:t})=>{const n=({isIdentityEstablished:t})=>e.getDocumentMayUnload()&&t;return Qt({payload:e,getAction:({isIdentityEstablished:e})=>n({isIdentityEstablished:e})?"collect":"interact",getUseSendBeacon:n,datastreamIdOverride:t})},Wt=t=>{const{content:n,addIdentity:o,hasIdentity:r}=t,s=a(n,"meta.configOverrides");return{mergeMeta:a(n,"meta"),mergeState:a(n,"meta.state"),mergeQuery:a(n,"query"),mergeConfigOverride:t=>s((t=>{if(e(t)||"object"!=typeof t)return null;const n=U(t,(t=>!(e(t)||!te(t)&&!ne(t)&&!se(t)&&!v(t))));return A(n)?null:n})(t)),addIdentity:o,hasIdentity:r,toJSON:()=>n}},Xt=e=>t=>void 0!==(e.xdm&&e.xdm.identityMap&&e.xdm.identityMap[t]),Yt=()=>{const e={},t=Wt({content:e,addIdentity:Jt(e),hasIdentity:Xt(e)});return t.addEvent=t=>{e.events=e.events||[],e.events.push(t)},t.getDocumentMayUnload=()=>(e.events||[]).some((e=>e.getDocumentMayUnload())),t},$t=({localConfigOverrides:e,globalConfigOverrides:t,payload:n})=>{const o={payload:n},{datastreamId:r,...s}=e||{};return r&&(o.datastreamIdOverride=r),t&&!A(t)&&n.mergeConfigOverride(t),s&&!A(s)&&n.mergeConfigOverride(s),o};const Kt="clientId";const Zt="Event was canceled because the onBeforeEventSend callback returned false.";var en=({orgId:e,targetMigrationEnabled:t})=>n=>((e,t)=>0===t.indexOf(B+"_"+F(e)+"_"))(e,n)||"at_qa_mode"===n||t&&"mbox"===n;var tn=e=>((...e)=>e.length<2?Object.assign(...e):e.reduce(((e,n)=>(t(n)&&Object.keys(n).forEach((t=>{Array.isArray(n[t])?Array.isArray(e[t])?e[t].push(...n[t]):e[t]=[...n[t]]:e[t]=n[t]})),e))))({},...e.shift()||[],...e.shift()||[],...e),nn=e=>t=>{const n=()=>{throw t};return e.call({error:t}).then(n,n)};const on="The server responded with a";var rn=({orgId:e,cookieJar:t})=>{const n=V(e,"cluster");return()=>t.get(n)||(()=>{const e=t.get("mboxEdgeCluster");if(e)return"t"+e})()};const sn=[429,503,502,504];var an=({response:e,retriesAttempted:t})=>t<3&&sn.includes(e.statusCode);var cn=({response:e,retriesAttempted:t})=>{let n=(e=>{const t=e.getHeader("Retry-After");let n;if(t){const e=parseInt(t,10);n=oe(e)?1e3*e:Math.max(0,new Date(t).getTime()-(new Date).getTime())}return n})(e);return void 0===n&&(n=(e=>{const t=1e3+1e3*e,n=.3*t,o=t-n,r=t+n;return Math.round(o+Math.random()*(r-o))})(t)),n};var dn="2.26.0",ln=[["architecture","string"],["bitness","string"],["model","string"],["platformVersion","string"],["wow64","boolean"]];const un=(e=>t=>{const n={webPageDetails:{URL:e.location.href||e.location},webReferrer:{URL:e.document.referrer}};i(t,{web:n})})(window),gn=(e=>t=>{const{screen:{width:n,height:o}}=e,r={},s=pe(o);s>=0&&(r.screenHeight=s);const a=pe(n);a>=0&&(r.screenWidth=a);const c=(e=>{const{screen:{orientation:t}}=e;if(null==t||null==t.type)return null;const n=t.type.split("-");return 0===n.length||"portrait"!==n[0]&&"landscape"!==n[0]?null:n[0]})(e)||(e=>{if(w(e.matchMedia)){if(e.matchMedia("(orientation: portrait)").matches)return"portrait";if(e.matchMedia("(orientation: landscape)").matches)return"landscape"}return null})(e);c&&(r.screenOrientation=c),Object.keys(r).length>0&&i(t,{device:r})})(window),pn=(e=>t=>{const{document:{documentElement:{clientWidth:n,clientHeight:o}={}}}=e,r={type:"browser"},s=pe(n);s>=0&&(r.browserDetails={viewportWidth:s});const a=pe(o);a>=0&&(r.browserDetails=r.browserDetails||{},r.browserDetails.viewportHeight=a),i(t,{environment:r})})(window),mn=(fn=()=>new Date,e=>{const t=fn(),n={},o=pe(t.getTimezoneOffset());void 0!==o&&(n.localTimezoneOffset=o),(void 0===o||Math.abs(o)<6e3)&&(n.localTime=(e=>{const t=e.getFullYear(),n=me(e.getMonth()+1,2,"0"),o=me(e.getDate(),2,"0"),r=me(e.getHours(),2,"0"),s=me(e.getMinutes(),2,"0"),i=me(e.getSeconds(),2,"0"),a=me(e.getMilliseconds(),3,"0"),c=pe(e.getTimezoneOffset(),0);return t+"-"+n+"-"+o+"T"+r+":"+s+":"+i+"."+a+(c>0?"-":"+")+me(Math.floor(Math.abs(c)/60),2,"0")+":"+me(Math.abs(c)%60,2,"0")})(t)),i(e,{placeContext:n})});var fn;const hn=(e=>t=>{const n=e().toISOString();i(t,{timestamp:n})})((()=>new Date)),yn={web:un,device:gn,environment:pn,placeContext:mn},wn={highEntropyUserAgentHints:(e=>(e=>void 0!==e.userAgentData)(e)?(t,n)=>{try{return e.userAgentData.getHighEntropyValues(ln.map((e=>e[0]))).then((e=>{const n={};ln.forEach((([t,o])=>{Object.prototype.hasOwnProperty.call(e,t)&&typeof e[t]===o&&(n[t]=e[t])})),i(t,{environment:{browserDetails:{userAgentClientHints:n}}})}))}catch(e){return n.warn("Unable to collect user-agent client hints. "+e.message),ie}}:ie)(navigator)},vn={...yn,...wn},bn=[hn,e=>{i(e,{implementationDetails:{name:"https://ns.adobe.com/experience/alloy",version:dn,environment:"browser"}})}],Cn=({config:e,logger:t})=>((e,t,n,o)=>{const r=e.context.flatMap(((e,o)=>n[e]?[n[e]]:(t.warn("Invalid context["+o+"]: '"+e+"' is not available."),[]))).concat(o);return{namespace:"Context",lifecycle:{onBeforeEvent({event:e}){const n={};return Promise.all(r.map((e=>Promise.resolve(e(n,t))))).then((()=>e.mergeXdm(n)))}}}})(e,t,vn,bn);Cn.namespace="Context",Cn.configValidators=gt({context:it(pt()).default(Object.keys(yn))});const In=({eventManager:e,logger:t})=>({commands:{sendEvent:{documentationUri:"https://adobe.ly/3GQ3Q7t",optionsValidator:e=>(({options:e})=>gt({type:pt(),xdm:gt({eventType:pt(),identityMap:ft}),data:gt({}),documentUnloading:at(),renderDecisions:at(),decisionScopes:it(pt()).uniqueItems(),personalization:gt({decisionScopes:it(pt()).uniqueItems(),surfaces:it(pt()).uniqueItems(),sendDisplayEvent:at().default(!0),includeRenderedPropositions:at().default(!1),defaultPersonalizationEnabled:at(),decisionContext:gt({})}).default({sendDisplayEvent:!0}),datasetId:pt(),mergeId:pt(),edgeConfigOverrides:ht,initializePersonalization:at()}).required().noUnknownFields()(e))({options:e}),run:n=>{const{xdm:o,data:r,documentUnloading:s,type:a,mergeId:c,datasetId:d,edgeConfigOverrides:l,...u}=n,g=e.createEvent();return s&&g.documentMayUnload(),g.setUserXdm(o),g.setUserData(r),a&&g.mergeXdm({eventType:a}),c&&g.mergeXdm({eventMergeId:c}),l&&(u.edgeConfigOverrides=l),d&&(t.warn("The 'datasetId' option has been deprecated. Please use 'edgeConfigOverrides.com_adobe_experience_platform.datasets.event.datasetId' instead."),u.edgeConfigOverrides=l||{},i(u.edgeConfigOverrides,{com_adobe_experience_platform:{datasets:{event:{datasetId:d}}}})),e.sendEvent(g,u)}},applyResponse:{documentationUri:"",optionsValidator:e=>(({options:e})=>gt({renderDecisions:at(),responseHeaders:ut(pt().required()),responseBody:gt({handle:it(gt({type:pt().required(),payload:st().required()})).required()}).required(),personalization:gt({sendDisplayEvent:at().default(!0),decisionContext:gt({})}).default({sendDisplayEvent:!0})}).noUnknownFields()(e))({options:e}),run:t=>{const{renderDecisions:n=!1,decisionContext:o={},responseHeaders:r={},responseBody:s={handle:[]},personalization:i}=t,a=e.createEvent();return e.applyResponse(a,{renderDecisions:n,decisionContext:o,responseHeaders:r,responseBody:s,personalization:i})}}}});In.namespace="DataCollector";const En=(e,t)=>"ID sync "+(t?"succeeded":"failed")+": "+e.spec.url;const kn=gt({thirdPartyCookiesEnabled:at().default(!0),idMigrationEnabled:at().default(!0)});var Pn=gt({url:pt().required().nonEmpty(),edgeConfigOverrides:ht}).required().noUnknownFields(),Rn="ECID",Dn=({logger:e})=>new Promise(((n,o)=>{if(t(window.adobe)&&t(window.adobe.optIn)){const t=window.adobe.optIn;e.info("Delaying request while waiting for legacy opt-in to let Visitor retrieve ECID from server."),t.fetchPermissions((()=>{t.isApproved([t.Categories.ECID])?(e.info("Received legacy opt-in approval to let Visitor retrieve ECID from server."),n()):o(new Error("Legacy opt-in was declined."))}),!0)}else n()})),Sn=({logger:e,orgId:t,awaitVisitorOptIn:n})=>()=>{const o=(e=>{const t=e.Visitor;return w(t)&&w(t.getInstance)&&t})(window);return o?n({logger:e}).then((()=>(e.info("Delaying request while using Visitor to retrieve ECID from server."),new Promise((n=>{o.getInstance(t,{}).getMarketingCloudVisitorID((t=>{e.info("Resuming previously delayed request that was waiting for ECID from Visitor."),n(t)}),!0)}))))).catch((t=>{t?e.info(t.message+", retrieving ECID from experience edge"):e.info("An error occurred while obtaining the ECID from Visitor.")})):Promise.resolve()},On="CORE",Tn=e=>{try{return decodeURIComponent(e)}catch{return""}};var Nn=(e,t)=>{e.addIdentity(Rn,{id:t})},qn=e=>e.getPayloadsByType("identity:result").reduce(((e,t)=>(t.namespace&&t.namespace.code&&(e[t.namespace.code]=t.id),e)),{}),xn=({payload:e,datastreamIdOverride:t})=>Qt({payload:e,datastreamIdOverride:t,getAction:()=>"identity/acquire",getUseSendBeacon:()=>!1}),Mn=e=>{const t={query:{identity:{fetch:e}}};return Wt({content:t,addIdentity:Jt(t),hasIdentity:Xt(t)})};const An=/^([^?#]*)(\??[^#]*)(#?.*)$/;const Un=gt({namespaces:it(mt(Rn,On)).nonEmpty().uniqueItems().default([Rn]),edgeConfigOverrides:ht}).noUnknownFields().default({namespaces:[Rn]});const Ln=(e,t)=>{let n,o=0,r=0;do{if(t<0||t+r>=e.length)throw new Error("Invalid varint: buffer ended unexpectedly");if(n=e[t+r],o|=(127&n)<<7*r,r+=1,r>10)throw new Error("Invalid varint: too long")}while(128&n);return{value:o,length:r}},jn=Object.freeze({VARINT:0,I64:1,LEN:2,SGROUP:3,EGROUP:4,I32:5});var Bn=({orgId:e,cookieJar:t,logger:n})=>{const o=V(e,"identity");return()=>{const e=t.get(o);if(!e)return null;try{const t=decodeURIComponent(e).replace(/_/g,"/").replace(/-/g,"+");return(e=>{let t=0,n=null;for(;t<e.length&&!n;){const{value:o,length:r}=Ln(e,t);t+=r;const s=7&o;if(1==o>>3){if(s===jn.LEN){const o=Ln(e,t);return t+=o.length,n=(new TextDecoder).decode(e.slice(t,t+o.value)),t+=o.value,n}}else switch(s){case jn.VARINT:t+=Ln(e,t).length;break;case jn.I64:t+=8;break;case jn.LEN:{const n=Ln(e,t);t+=n.length+n.value;break}case jn.SGROUP:case jn.EGROUP:break;case jn.I32:t+=4;break;default:throw new Error("Malformed kndctr cookie. Unknown wire type: "+s)}}throw new Error("No ECID found in cookie.")})((e=>{const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)))})(t))}catch(e){return n.warn("Unable to decode ECID from "+o+" cookie",e),null}}};const Fn=({config:e,logger:t,consent:n,fireReferrerHideableImage:o,sendEdgeNetworkRequest:s,apexDomain:i,getBrowser:a})=>{const{orgId:c,thirdPartyCookiesEnabled:l,edgeConfigOverrides:u}=e,g=Sn({logger:t,orgId:c,awaitVisitorOptIn:Dn}),p=d({logger:t,cookieJar:r}),m=(({config:e,getEcidFromVisitor:t,apexDomain:n,isPageSsl:o,cookieJar:r})=>{const{idMigrationEnabled:s,orgId:i}=e,a="AMCV_"+i,c=()=>{let e=null;const t=r.get("s_ecid")||r.get(a);if(t){const n=/(^|\|)MCMID\|(\d+)($|\|)/,o=t.match(n);o&&(e=o[2])}return e};return{getEcid(){if(s){const e=c();return e?Promise.resolve(e):t()}return Promise.resolve()},setEcid(e){if(s&&c()!==e){const t=o?{sameSite:"none",secure:!0}:{};r.set(a,"MCMID|"+e,{domain:n,expires:390,...t})}}}})({config:e,getEcidFromVisitor:g,apexDomain:i,cookieJar:p,isPageSsl:"https:"===window.location.protocol}),f=(({orgId:e})=>{const t=V(e,"identity");return()=>Boolean(r.get(t))})({orgId:c}),h=(({sendEdgeNetworkRequest:e,createIdentityRequestPayload:t,createIdentityRequest:n,globalConfigOverrides:o})=>({namespaces:r,edgeConfigOverrides:s}={})=>{const i=$t({payload:t(r),globalConfigOverrides:o,localConfigOverrides:s}),a=n(i);return e({request:a})})({sendEdgeNetworkRequest:s,createIdentityRequestPayload:Mn,createIdentityRequest:xn,globalConfigOverrides:u}),y=(({getBrowser:e})=>Y((()=>$.includes(e()))))({getBrowser:a}),w=(({thirdPartyCookiesEnabled:e,areThirdPartyCookiesSupportedByDefault:t})=>n=>{e&&t()&&n.setUseIdThirdPartyDomain()})({thirdPartyCookiesEnabled:l,areThirdPartyCookiesSupportedByDefault:y}),v=(({getLegacyEcid:e,addEcidToPayload:t})=>n=>n.hasIdentity(Rn)?Promise.resolve():e().then((e=>{e&&t(n,e)})))({getLegacyEcid:m.getEcid,addEcidToPayload:Nn}),b=(({locationSearch:e,dateProvider:t,orgId:n,logger:o})=>r=>{if(r.hasIdentity(Rn))return;let s=de.parse(e).adobe_mc;if(void 0===s)return;Array.isArray(s)&&(o.warn("Found multiple adobe_mc query string paramters, only using the last one."),s=s[s.length-1]);const i=s.split("|").reduce(((e,t)=>{const[n,o]=t.split("=");return e[n]=Tn(o),e[n]=e[n].replace(/[^a-zA-Z0-9@.]/g,""),e}),{}),a=parseInt(i.TS,10),c=i.MCMID,d=Tn(i.MCORGID);t().getTime()/1e3<=a+300&&d===n&&c?(o.info("Found valid ECID identity "+c+" from the adobe_mc query string parameter."),r.addIdentity(Rn,{id:c})):o.info("Detected invalid or expired adobe_mc query string parameter.")})({locationSearch:window.document.location.search,dateProvider:()=>new Date,orgId:c,logger:t}),C=(({doesIdentityCookieExist:e,orgId:t,logger:n})=>({onResponse:o,onRequestFailure:r})=>new Promise(((s,i)=>{o((()=>{e()?s():(n.warn("Identity cookie not found. This could be caused by any of the following issues:\n\t* The org ID "+t+" configured in Alloy doesn't match the org ID specified in the edge configuration.\n\t* Experience edge was not able to set the identity cookie due to domain or cookie restrictions.\n\t* The request was canceled by the browser and not fully processed."),i(new Error("Identity cookie not found.")))})),r((()=>{e()?s():i(new Error("Identity cookie not found."))}))})))({doesIdentityCookieExist:f,orgId:c,logger:t}),I=(({doesIdentityCookieExist:e,setDomainForInitialIdentityPayload:t,addLegacyEcidToPayload:n,awaitIdentityCookie:o,logger:r})=>{let s;const i=e=>(t(e),n(e.getPayload()));return({request:t,onResponse:n,onRequestFailure:a})=>{if(e())return t.setIsIdentityEstablished(),Promise.resolve();if(s){r.info("Delaying request while retrieving ECID from server.");const e=s;return s=e.catch((()=>o({onResponse:n,onRequestFailure:a}))),e.then((()=>{r.info("Resuming previously delayed request."),t.setIsIdentityEstablished()})).catch((()=>i(t)))}return s=o({onResponse:n,onRequestFailure:a}),s.catch((()=>{})),i(t)}})({doesIdentityCookieExist:f,setDomainForInitialIdentityPayload:w,addLegacyEcidToPayload:v,awaitIdentityCookie:C,logger:t}),E=(({fireReferrerHideableImage:e,logger:t})=>n=>{const o=n.filter((e=>"url"===e.type));return o.length?Promise.all(o.map((n=>e(n.spec).then((()=>{t.info(En(n,!0))})).catch((()=>{t.error(En(n,!1))}))))).then(ie):Promise.resolve()})({fireReferrerHideableImage:o,logger:t}),k=(({processIdSyncs:e})=>t=>e(t.getPayloadsByType("identity:exchange")))({processIdSyncs:E}),P=(({dateProvider:e,orgId:t})=>(n,o)=>{const r=Math.round(e().getTime()/1e3),s=encodeURIComponent("TS="+r+"|MCMID="+n+"|MCORGID="+encodeURIComponent(t)),[,i,a,c]=o.match(An),d=(e=>""===e?"?":"?"===e?"":"&")(a);return""+i+a+d+"adobe_mc="+s+c})({dateProvider:()=>new Date,orgId:c}),R=(({thirdPartyCookiesEnabled:e})=>t=>{const n=Un(t);if(!e&&n.namespaces.includes(On))throw new Error("namespaces: The CORE namespace cannot be requested when third-party cookies are disabled.");return n})({thirdPartyCookiesEnabled:l}),D=(({thirdPartyCookiesEnabled:e,areThirdPartyCookiesSupportedByDefault:t})=>{const n={identity:{fetch:[Rn]}};return e&&t()&&n.identity.fetch.push(On),e=>{e.mergeQuery(n)}})({thirdPartyCookiesEnabled:l,areThirdPartyCookiesSupportedByDefault:y}),S=Bn({orgId:c,cookieJar:p,logger:t});return(({addEcidQueryToPayload:e,addQueryStringIdentityToPayload:t,ensureSingleIdentity:n,setLegacyEcid:o,handleResponseForIdSyncs:r,getNamespacesFromResponse:s,getIdentity:i,consent:a,appendIdentityToUrl:c,logger:d,getIdentityOptionsValidator:l,decodeKndctrCookie:u})=>{let g,p={};return{lifecycle:{onBeforeRequest:({request:o,onResponse:r,onRequestFailure:s})=>(e(o.getPayload()),t(o.getPayload()),n({request:o,onResponse:r,onRequestFailure:s})),onResponse({response:e}){const t=s(e);return g&&g[Rn]||!t||!t[Rn]||o(t[Rn]),t&&Object.keys(t).length>0&&(g={...g,...t}),p={...p,...e.getEdge()},r(e)}},commands:{getIdentity:{optionsValidator:l,run:e=>{const{namespaces:t}=e;return a.awaitConsent().then((()=>{if(g)return;const n=u();return n&&t.includes(Rn)&&(g||(g={}),g[Rn]=n,1===t.length)?void 0:i(e)})).then((()=>({identity:t.reduce(((e,t)=>(e[t]=g[t]||null,e)),{}),edge:p})))}},appendIdentityToUrl:{optionsValidator:Pn,run:e=>a.withConsent().then((()=>{if(g)return;const t=u();return t?(g||(g={}),void(g[Rn]=t)):i(e)})).then((()=>({url:c(g[Rn],e.url)}))).catch((t=>(d.warn("Unable to append identity to url. "+t.message),e)))}}}})({addEcidQueryToPayload:D,addQueryStringIdentityToPayload:b,ensureSingleIdentity:I,setLegacyEcid:m.setEcid,handleResponseForIdSyncs:k,getNamespacesFromResponse:qn,getIdentity:h,consent:n,appendIdentityToUrl:P,logger:t,getIdentityOptionsValidator:R,decodeKndctrCookie:S})};Fn.namespace="Identity",Fn.configValidators=kn;const Vn=({config:e,componentRegistry:t})=>{const n=[...t.getCommandNames(),At,Ut].sort(),o={...e};Object.keys(e).forEach((t=>{const n=e[t];"function"==typeof n&&(o[t]=n.toString())}));const r=t.getComponentNames();return{version:dn,configs:o,commands:n,components:r}},zn=({config:e,componentRegistry:t})=>({commands:{getLibraryInfo:{run:()=>({libraryInfo:Vn({config:e,componentRegistry:t})})}}});zn.namespace="LibraryInfo";var Hn=Object.freeze({__proto__:null,context:Cn,dataCollector:In,identity:Fn,libraryInfo:zn});const _n=(Jn=window,e=>{const t=L+e;return{session:K(Jn,"sessionStorage",t),persistent:K(Jn,"localStorage",t)}});var Jn;const{console:Qn,fetch:Gn,navigator:Wn}=window,Xn=()=>window.__alloyMonitors||[],Yn=gt({debugEnabled:at().default(!1),datastreamId:pt().unique().required(),edgeDomain:pt().domain().default("edge.adobedc.net"),edgeBasePath:pt().nonEmpty().default("ee"),orgId:pt().unique().required(),onBeforeEventSend:ct().default(ie),edgeConfigOverrides:ht}).renamed("edgeConfigId",pt().unique(),"datastreamId"),$n=((e,t)=>{let n="";const o=e.location.hostname.toLowerCase().split(".");let r=1;for(;r<o.length&&!t.get(j);)r+=1,n=(s=o,i=r,s.slice(-i)).join("."),t.set(j,j,{domain:n});var s,i;return t.remove(j,{domain:n}),n})(window,r),Kn=(({fetch:e})=>(t,n)=>e(t,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"text/plain; charset=UTF-8"},referrerPolicy:"no-referrer-when-downgrade",body:n}).then((e=>e.text().then((t=>({statusCode:e.status,getHeader:t=>e.headers.get(t),body:t}))))))({fetch:Gn}),Zn=(({appendNode:e=g,awaitSelector:t=N,createNode:n=p,fireImage:o=y}={})=>{const r=o;let s;const i=({src:r})=>t("BODY").then((([t])=>s||(s=n("IFRAME",x,M),e(t,s)))).then((e=>{const t=e.contentWindow.document;return o({src:r,currentDocument:t})}));return e=>{const{hideReferrer:t,url:n}=e;return t?i({src:n}):r({src:n})}})(),eo=(({window:e,createNamespacedStorage:t})=>{const n=t("validation.");return()=>{const t=de.parse(e.location.search).adb_validation_sessionid;if(!t)return"";const o=(e=>{let t=e.persistent.getItem(Kt);return t||(t=ve(),e.persistent.setItem(Kt,t)),t})(n),r=t+"|"+o;return"&"+de.stringify({adobeAepValidationToken:r})}})({window:window,createNamespacedStorage:_n}),to=(({userAgent:e})=>Y((()=>((e,t)=>{const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const r=n[o];if(e[r].test(t))return r}return X})({[_]:/Edge\/([0-9\._]+)/,[J]:/Edg\/([0-9\.]+)/,[H]:/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/,[Q]:/Firefox\/([0-9\.]+)(?:\s|$)/,[G]:/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/,[W]:/Version\/([0-9\._]+).*Safari/},e))))({userAgent:window.navigator.userAgent}),no=({instanceName:e,logController:{setDebugEnabled:t,logger:n,createComponentLogger:o},components:s})=>{const i=It(),a=bt(i),l=s.concat(Object.values(Hn)),u=d({logger:n,cookieJar:r}),g=zt({errorPrefix:"["+e+"]",logger:n}),p=Lt({logger:n,configureCommand:s=>{const d=Ft({options:s,componentCreators:l,coreConfigValidators:Yn,createConfig:Vt,logger:n,setDebugEnabled:t}),{orgId:g,targetMigrationEnabled:p}=d,m=en({orgId:g,targetMigrationEnabled:p}),f=(({cookieJar:e,shouldTransferCookie:t,apexDomain:n,dateProvider:o})=>({cookiesToPayload(o,r){const s=""!==n&&r.endsWith(n),i={domain:n,cookiesEnabled:!0};if(!s){const n=e.get(),o=Object.keys(n).filter(t).map((e=>({key:e,value:n[e]})));o.length&&(i.entries=o)}o.mergeState(i)},responseToCookies(t){t.getPayloadsByType("state:store").forEach((t=>{const r={domain:n},s=t.attrs&&t.attrs.SameSite&&t.attrs.SameSite.toLowerCase();void 0!==t.maxAge&&(r.expires=new Date(o().getTime()+1e3*t.maxAge)),void 0!==s&&(r.sameSite=s),"none"===s&&(r.secure=!0),e.set(t.key,t.value,r)}))}}))({cookieJar:u,shouldTransferCookie:m,apexDomain:$n,dateProvider:()=>new Date}),h=w(Wn.sendBeacon)?(({sendBeacon:e,sendFetchRequest:t,logger:n})=>(o,r)=>{const s=new Blob([r],{type:"text/plain; charset=UTF-8"});return e(o,s)?Promise.resolve({statusCode:204,getHeader:()=>null,body:""}):(n.info("Unable to use `sendBeacon`; falling back to `fetch`."),t(o,r))})({sendBeacon:Wn.sendBeacon.bind(Wn),sendFetchRequest:Kn,logger:n}):Kn,y=(({logger:e,sendFetchRequest:t,sendBeaconRequest:n,isRequestRetryable:o,getRequestRetryDelay:r})=>({requestId:s,url:i,payload:a,useSendBeacon:c})=>{const d=JSON.stringify(a),l=JSON.parse(d);e.logOnBeforeNetworkRequest({url:i,requestId:s,payload:l});const u=(a=0)=>(c?n:t)(i,d).then((t=>{if(o({response:t,retriesAttempted:a})){const e=r({response:t,retriesAttempted:a});return new Promise((t=>{setTimeout((()=>{t(u(a+1))}),e)}))}let n;try{n=JSON.parse(t.body)}catch{}return e.logOnNetworkResponse({requestId:s,url:i,payload:l,...t,parsedBody:n,retriesAttempted:a}),{statusCode:t.statusCode,body:t.body,parsedBody:n,getHeader:t.getHeader}}));return u().catch((t=>{throw e.logOnNetworkError({requestId:s,url:i,payload:l,error:t}),ge({error:t,message:"Network request failed."})}))})({logger:n,sendFetchRequest:Kn,sendBeaconRequest:h,isRequestRetryable:an,getRequestRetryDelay:cn}),v=(({logger:e})=>t=>{const{statusCode:n,body:o,parsedBody:r}=t;if(n<200||n>=300||!r&&204!==n||r&&!Array.isArray(r.handle)){const e=r?JSON.stringify(r,null,2):o;throw new Error(on+" status code "+n+" and "+(e?"response body:\n"+e:"no response body."))}if(r){const{warnings:t=[],errors:n=[]}=r;t.forEach((t=>{e.warn(on+" warning:",t)})),n.forEach((t=>{e.error(on+" non-fatal error:",t)}))}})({logger:n}),b=(({logger:e})=>t=>{if(t){const n=t.split(";");if(n.length>=2&&n[1].length>0)try{const e=parseInt(n[1],10);if(!Number.isNaN(e))return{regionId:e}}catch{}e.warn('Invalid adobe edge: "'+t+'"')}return{}})({logger:n}),C=(({extractEdgeInfo:e})=>({content:t={},getHeader:n})=>{const{handle:o=[],errors:r=[],warnings:s=[]}=t;return{getPayloadsByType:e=>o.filter((t=>t.type===e)).flatMap((e=>e.payload)),getErrors:()=>r,getWarnings:()=>s,getEdge:()=>e(n("x-adobe-edge")),toJSON:()=>t}})({extractEdgeInfo:b}),I=rn({orgId:g,cookieJar:r}),E=(({config:e,lifecycle:t,cookieTransfer:n,sendNetworkRequest:o,createResponse:r,processWarningsAndErrors:s,getLocationHint:i,getAssuranceValidationTokenParams:a})=>{const{edgeDomain:d,edgeBasePath:l,datastreamId:u}=e;let g=!1;const p=(e,t)=>{const n=i(),o=n?l+"/"+n+t.getEdgeSubPath():""+l+t.getEdgeSubPath(),r=t.getDatastreamIdOverride()||u;return r!==u&&t.getPayload().mergeMeta({sdkConfig:{datastream:{original:u}}}),"https://"+e+"/"+o+"/v1/"+t.getAction()+"?configId="+r+"&requestId="+t.getId()+a()};return({request:e,runOnResponseCallbacks:i=ie,runOnRequestFailureCallbacks:a=ie})=>{const l=c();l.add(t.onResponse),l.add(i);const u=c();return u.add(t.onRequestFailure),u.add(a),t.onBeforeRequest({request:e,onResponse:l.add,onRequestFailure:u.add}).then((()=>{const t=g||!e.getUseIdThirdPartyDomain()?d:"adobedc.demdex.net",r=p(t,e),s=e.getPayload();return n.cookiesToPayload(s,t),o({requestId:e.getId(),url:r,payload:s,useSendBeacon:e.getUseSendBeacon()})})).then((e=>(s(e),e))).catch((t=>{if(((e,t)=>t.getUseIdThirdPartyDomain()&&(e=>"TypeError"===e.name||"NetworkError"===e.name||0===e.status)(e))(t,e)){g=!0,e.setUseIdThirdPartyDomain(!1);const t=p(d,e),r=e.getPayload();return n.cookiesToPayload(r,d),o({requestId:e.getId(),url:t,payload:r,useSendBeacon:e.getUseSendBeacon()})}return nn(u)(t)})).then((({parsedBody:e,getHeader:t})=>{const o=r({content:e,getHeader:t});return n.responseToCookies(o),l.call({response:o}).then(tn)}))}})({config:d,lifecycle:a,cookieTransfer:f,sendNetworkRequest:y,createResponse:C,processWarningsAndErrors:v,getLocationHint:I,getAssuranceValidationTokenParams:eo}),k=(({cookieTransfer:e,lifecycle:t,createResponse:n,processWarningsAndErrors:o})=>({request:r,responseHeaders:s,responseBody:i,runOnResponseCallbacks:a=ie,runOnRequestFailureCallbacks:d=ie})=>{const l=c();l.add(t.onResponse),l.add(a);const u=c();u.add(t.onRequestFailure),u.add(d);const g=e=>s[e];return t.onBeforeRequest({request:r,onResponse:l.add,onRequestFailure:u.add}).then((()=>o({statusCode:200,getHeader:g,body:JSON.stringify(i),parsedBody:i}))).catch(nn(u)).then((()=>{const t=n({content:i,getHeader:g});return e.responseToCookies(t),l.call({response:t}).then(tn)}))})({lifecycle:a,cookieTransfer:f,createResponse:C,processWarningsAndErrors:v}),P=(({generalConsentState:e,logger:t})=>{const n=(n,o)=>{switch(n[Rt]){case Et:e.in(o);break;case kt:e.out(o);break;case Pt:e.pending(o);break;default:t.warn("Unknown consent value: "+n[Rt])}};return{initializeConsent(e,t){t[Rt]?n(t,Ot):n(e,St)},setConsent(e){n(e,Tt)},suspend(){e.pending()},awaitConsent:()=>e.awaitConsent(),withConsent:()=>e.withConsent(),current:()=>e.current()}})({generalConsentState:qt({logger:n}),logger:n}),R=(({config:e,logger:t,lifecycle:n,consent:o,createEvent:r,createDataCollectionRequestPayload:s,createDataCollectionRequest:i,sendEdgeNetworkRequest:a,applyResponse:d})=>{const{onBeforeEventSend:l,edgeConfigOverrides:u}=e;return{createEvent:r,sendEvent(e,r={}){const{edgeConfigOverrides:d,...g}=r,p=$t({payload:s(),localConfigOverrides:d,globalConfigOverrides:u}),m=i(p),f=c(),h=c();return n.onBeforeEvent({...g,event:e,onResponse:f.add,onRequestFailure:h.add}).then((()=>(p.payload.addEvent(e),o.awaitConsent()))).then((()=>{try{e.finalize(l)}catch(e){const t=()=>{throw e};return h.add(n.onRequestFailure),h.call({error:e}).then(t,t)}if(!e.shouldSend()){h.add(n.onRequestFailure),t.info(Zt);const e=new Error(Zt);return h.call({error:e}).then((()=>{}))}return a({request:m,runOnResponseCallbacks:f.call,runOnRequestFailureCallbacks:h.call})}))},applyResponse(e,t={}){const{renderDecisions:o=!1,decisionContext:r={},responseHeaders:a={},responseBody:l={handle:[]},personalization:u}=t,g=s(),p=i({payload:g}),m=c();return n.onBeforeEvent({event:e,renderDecisions:o,decisionContext:r,decisionScopes:[_t],personalization:u,onResponse:m.add,onRequestFailure:ie}).then((()=>(g.addEvent(e),d({request:p,responseHeaders:a,responseBody:l,runOnResponseCallbacks:m.call}))))}}})({config:d,logger:n,lifecycle:a,consent:P,createEvent:Mt,createDataCollectionRequestPayload:Yt,createDataCollectionRequest:Gt,sendEdgeNetworkRequest:E,applyResponse:k});return(({componentCreators:e,lifecycle:t,componentRegistry:n,getImmediatelyAvailableTools:o})=>(e.forEach((e=>{const{namespace:t}=e,r=o(t);let s;try{s=e(r)}catch(e){throw ge({error:e,message:"["+t+"] An error occurred during component creation."})}n.register(t,s)})),t.onComponentsRegistered({lifecycle:t}).then((()=>n))))({componentCreators:l,lifecycle:a,componentRegistry:i,getImmediatelyAvailableTools(t){const n=o(t);return{config:d,componentRegistry:i,consent:P,eventManager:R,fireReferrerHideableImage:Zn,logger:n,lifecycle:a,sendEdgeNetworkRequest:E,handleError:zt({errorPrefix:"["+e+"] ["+t+"]",logger:n}),createNamespacedStorage:_n,apexDomain:$n,getBrowser:to}}})},setDebugCommand:e=>{t(e.enabled,{fromConfig:!1})},handleError:g,validateCommandOptions:Bt});return p};const oo=pt().regexp().default("\\.(exe|zip|wav|mp3|mov|mpg|avi|wmv|pdf|doc|docx|xls|xlsx|ppt|pptx)$");gt({clickCollectionEnabled:at().default(!0),clickCollection:gt({internalLinkEnabled:at().default(!0),externalLinkEnabled:at().default(!0),downloadLinkEnabled:at().default(!0),sessionStorageEnabled:at().default(!1),eventGroupingEnabled:at().default(!1),filterClickProperties:ct()}).default({internalLinkEnabled:!0,externalLinkEnabled:!0,downloadLinkEnabled:!0,sessionStorageEnabled:!1,eventGroupingEnabled:!1}),downloadLinkQualifier:oo,onBeforeLinkClickSend:ct().deprecated('The field "onBeforeLinkClickSend" has been deprecated. Use "clickCollection.filterClickDetails" instead.')}),gt({consent:it(st()).required().nonEmpty(),identityMap:ft,edgeConfigOverrides:ht}).noUnknownFields().required(),gt({defaultConsent:mt(Et,kt,Pt).default(Et)});const ro="web",so="webapp",io="://",ao=/^(\w+):\/\/([^/#]+)(\/[^#]*)?(#.*)?$/,co=/^(?:.*@)?(?:[a-z\d\u00a1-\uffff.-]+|\[[a-f\d:]+])(?::\d+)?$/,lo=/^\/(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})*$/,uo=/^#(?:[/\w\u00a1-\uffff-.~]|%[a-fA-F\d]{2})+$/,go=(e="/")=>{let t=e.length;for(;t>0&&-1!=="/".indexOf(e.charAt(t-1));)t-=1;return e.substring(0,t)||"/"},po=e=>""+e.surfaceType+io+e.authority+(e.path||"")+(e.fragment||""),mo=e=>{const t=e(),n=t.host.toLowerCase(),o=t.pathname;return ro+io+n+go(o)},fo=(e,t,n)=>{const o=e=>(n.warn(e),null);if(!se(e))return o("Invalid surface: "+e);const r=((e,t)=>e.startsWith("#")?mo(t)+e:e)(e,t),s=(e=>{const t=e.match(ao);return t?{surfaceType:(r=t[1],se(r)?r.toLowerCase():""),authority:(o=t[2],se(o)?o.toLowerCase():""),path:(n=t[3],se(n)?go(n):"/"),fragment:t[4]}:null;var n,o,r})(r);return null===s?o("Invalid surface: "+e):[ro,so].includes(s.surfaceType)?s.authority&&co.test(s.authority)?s.path&&!lo.test(s.path)?o("Invalid path "+s.path+" in surface: "+e):s.fragment&&!uo.test(s.fragment)?o("Invalid fragment "+s.fragment+" in surface: "+e):s:o("Invalid authority "+s.authority+" in surface: "+e):o("Unsupported surface type "+s.surfaceType+" in surface: "+e)},ho=e=>!!e&&0===e.indexOf(ro+io)&&-1===e.indexOf("#"),yo="https://ns.adobe.com/personalization/default-content-item",wo="https://ns.adobe.com/personalization/dom-action",vo="https://ns.adobe.com/personalization/html-content-item",bo="https://ns.adobe.com/personalization/json-content-item",Co="https://ns.adobe.com/personalization/redirect-item",Io="https://ns.adobe.com/personalization/message/in-app",Eo=e=>e.filter(((t,n)=>e.indexOf(t)===n));var ko=({getPageLocation:t,renderDecisions:n,decisionScopes:o,personalization:r,event:s,isCacheInitialized:i,logger:a})=>{const c=s.getViewName();return{isRenderDecisions:()=>n,isSendDisplayEvent:()=>!!r.sendDisplayEvent,shouldIncludeRenderedPropositions:()=>!!r.includeRenderedPropositions,getViewName:()=>c,hasScopes:()=>o.length>0||v(r.decisionScopes),hasSurfaces:()=>v(r.surfaces),hasViewName:()=>se(c),createQueryDetails(){const n=[...o];v(r.decisionScopes)&&n.push(...r.decisionScopes);const s=((t=[],n,o)=>t.map((e=>fo(e,n,o))).filter((t=>!e(t))).map(po))(r.surfaces,t,a);this.shouldRequestDefaultPersonalization()&&((e=>{e.includes(_t)||e.push(_t)})(n),((e,t)=>{const n=mo(t);e.includes(n)||e.push(n)})(s,t));const i=[yo,vo,bo,Co,"https://ns.adobe.com/personalization/ruleset-item",Io,"https://ns.adobe.com/personalization/message/content-card"];return n.includes(_t)&&i.push(wo),{schemas:i,decisionScopes:Eo(n),surfaces:Eo(s)}},isCacheInitialized:()=>i,shouldFetchData(){return this.hasScopes()||this.hasSurfaces()||this.shouldRequestDefaultPersonalization()},shouldUseCachedData(){return this.hasViewName()&&!this.shouldFetchData()},shouldRequestDefaultPersonalization(){return r.defaultPersonalizationEnabled||!this.isCacheInitialized()&&!1!==r.defaultPersonalizationEnabled}}};const Po="decisioning.propositionDisplay",Ro="decisioning.propositionInteract",Do="decisioning.propositionTrigger",So="decisioning.propositionDismiss",Oo="decisioning.propositionSuppressDisplay",To={DISPLAY:"display",INTERACT:"interact",TRIGGER:"trigger",DISMISS:"dismiss",SUPPRESS:"suppressDisplay"},No={[Po]:To.DISPLAY,[Ro]:To.INTERACT,[Do]:To.TRIGGER,[So]:To.DISMISS,[Oo]:To.SUPPRESS},qo=e=>No[e],xo={propositions:[]};var Mo=({getPageLocation:e,logger:t,fetchDataHandler:n,viewChangeHandler:o,onClickHandler:r,isAuthoringModeEnabled:s,mergeQuery:i,viewCache:a,showContainers:c,applyPropositions:d,setTargetMigration:l,mergeDecisionsMeta:u,renderedPropositions:g,onDecisionHandler:p,handleConsentFlicker:m})=>({lifecycle:{onComponentsRegistered(){m()},onDecision:p,onBeforeRequest:({request:e})=>(l(e),Promise.resolve()),onBeforeEvent({event:r,renderDecisions:d,decisionScopes:l=[],personalization:p={},onResponse:m=ie,onRequestFailure:f=ie}){if(m((()=>({propositions:[]}))),f((()=>c())),s())return t.warn("Rendering is disabled for authoring mode."),i(r,{enabled:!1}),Promise.resolve();const h=ko({getPageLocation:e,renderDecisions:d,decisionScopes:l,personalization:p,event:r,isCacheInitialized:a.isInitialized(),logger:t}),y=[];if(h.shouldIncludeRenderedPropositions()&&y.push(g.clear()),h.shouldFetchData()){const e=a.createCacheUpdate(h.getViewName());f((()=>e.cancel())),n({cacheUpdate:e,personalizationDetails:h,event:r,onResponse:m})}else h.shouldUseCachedData()&&y.push(o({personalizationDetails:h,event:r,onResponse:m,onRequestFailure:f}));return Promise.all(y).then((e=>{const t=e.flatMap((e=>e));v(t)&&u(r,t,[To.DISPLAY])}))},onClick({event:e,clickedElement:t}){r({event:e,clickedElement:t})}},commands:{applyPropositions:{optionsValidator:e=>(({logger:e,options:t})=>{const n=gt({propositions:it(gt({id:pt().required(),scope:pt().required(),scopeDetails:gt({decisionProvider:pt().required()}).required(),items:it(gt({id:pt().required(),schema:pt().required(),data:gt(st())})).nonEmpty().required()}).required()).nonEmpty().required(),metadata:gt(st()),viewName:pt()}).required();try{return n(t)}catch(t){return e.warn("Invalid options for applyPropositions. No propositions will be applied.",t),xo}})({logger:t,options:e}),run:d}}}),Ao=(e="undefined")=>p("DIV",{},{innerHTML:e});const Uo=/:eq\((\d+)\)/g,Lo=e=>-1===e.indexOf(":eq("),jo=/(#|\.)(-?\w+)/g,Bo=(e,t,n)=>""+t+CSS.escape(n),Fo=e=>{const t=[],n=(e=>e.split(Uo).filter(se))((e=>e.replace(jo,Bo))(e.trim())),{length:o}=n;let r=0;for(;r<o;){const e=n[r],o=n[r+1];o?t.push({sel:e,eq:Number(o)}):t.push({sel:e}),r+=2}return t},Vo=e=>{const t=document;if(Lo(e))return R(e,t);const n=Fo(e),{length:o}=n;let r=[],s=t,i=0;for(;i<o;){const{sel:e,eq:t}=n[i],a=R(e,s),{length:c}=a;if(0===c)break;if(null!=t&&t>c-1)break;i<o-1&&(null==t?[s]=a:s=a[t]),i===o-1&&(r=null==t?a:[a[t]]),i+=1}return r};var zo=(e,t=document)=>t.getElementById(e),Ho=(e,t,n)=>{e.setAttribute(t,n)},_o=(e,t)=>e.getAttribute(t),Jo=(e,t,n,o)=>{let r;r=o?t+":"+n+" !"+o+";":t+":"+n+";",e.style.cssText+=";"+r},Qo=e=>e.parentNode,Go=(e,t)=>{if(!e)return;const n=Qo(e);n&&n.insertBefore(t,(e=>e.nextElementSibling)(e))},Wo=(e,t)=>{if(!e)return;const n=Qo(e);n&&n.insertBefore(t,e)},Xo=e=>{const{childNodes:t}=e;return t?b(t):[]},Yo=e=>e.firstElementChild;let $o;var Ko=(e=document)=>{if(void 0===$o){const t=e.querySelector("[nonce]");$o=t&&(t.nonce||t.getAttribute("nonce"))}return $o};const Zo="src",er=e=>p(m,{src:e}),tr=e=>{R(m,e).forEach((e=>{const t=_o(e,Zo);t&&er(t)}))},nr=e=>((e,t)=>e.tagName===t)(e,f)&&!_o(e,Zo);var or=e=>{const t=R(f,e),{length:n}=t,o=Ko();if(o)for(let e=0;e<n;e+=1){const n=t[e];nr(n)&&(n.nonce=o)}};const rr=e=>{const t=document.createElement("script");t.src=e,t.async=!0;const n=((e,t)=>new Promise(((n,o)=>{t.onload=()=>{n(t)},t.onerror=()=>{o(new Error("Failed to load script: "+e))}})))(e,t);return document.head.appendChild(t),n},sr=(e,t)=>!!e&&e.tagName===t,ir=e=>sr(e,h)&&!_o(e,Zo),ar=e=>sr(e,h)&&_o(e,Zo),cr=e=>{const t=R(h,e),n=[],{length:o}=t,r=Ko(),s={...r&&{nonce:r}};for(let e=0;e<o;e+=1){const o=t[e];if(!ir(o))continue;const{textContent:r}=o;r&&n.push(p(h,s,{textContent:r}))}return n},dr=e=>{const t=R(h,e),n=[],{length:o}=t;for(let e=0;e<o;e+=1){const o=t[e];if(!ar(o))continue;const r=_o(o,Zo);r&&n.push(r)}return n},lr=(e,t)=>{t.forEach((t=>{e.appendChild(t),e.removeChild(t)}))},ur=e=>Promise.all(e.map(rr));var gr=(e,t,n)=>{const o=Ao(t);or(o);const r=Xo(o),s=cr(o),i=dr(o);return tr(o),r.forEach((t=>{g(e,t)})),n(e),lr(e,s),ur(i)};var pr=(e,t,n)=>((e=>{Xo(e).forEach(q)})(e),gr(e,t,n)),mr=(e,t,n)=>{const o=Ao(t);or(o);const r=Xo(o),s=cr(o),i=dr(o),{length:a}=r;let c=a-1;for(tr(o);c>=0;){const t=r[c];n(t);const o=Yo(e);o?Wo(o,t):g(e,t),c-=1}return lr(e,s),ur(i)};const fr="alloy-prehiding",hr={},yr=e=>{if(hr[e])return;const t=Ko(),n={...t&&{nonce:t}},o=p(f,n,{textContent:e+" { visibility: hidden }"});g(document.head,o),hr[e]=o},wr=e=>{const t=hr[e];t&&(q(t),delete hr[e])};var vr=(e,t,n)=>{n(e),e.textContent=t},br=(e,t,n)=>{const o=Ao(t);or(o);const r=Xo(o),s=cr(o),i=dr(o);return tr(o),r.forEach((t=>{n(t),Wo(e,t)})),lr(e,s),ur(i)},Cr=(e,t,n)=>br(e,t,n).then((()=>{q(e)})),Ir=(e,t,n)=>{const o=Ao(t);or(o);const r=Xo(o),s=cr(o),i=dr(o);tr(o);let a=e;return r.forEach((e=>{n(e),Go(a,e),a=e})),lr(e,s),ur(i)},Er=(e,t,n)=>{const{priority:o,...r}=t;Object.keys(r).forEach((t=>{Jo(e,t,r[t],o)})),n(e)},kr=(e,t,n)=>{Object.keys(t).forEach((n=>{Ho(e,n,t[n])})),n(e)},Pr=(e,t,n)=>{e.tagName===m&&(er(t),n(e),((e,t)=>{e.removeAttribute(t)})(e,Zo),Ho(e,Zo,t))},Rr=(e,{from:t,to:n},o)=>{const r=(e=>{const{children:t}=e;return t?b(t):[]})(e),s=r[t],i=r[n];s&&i&&(t<n?Go(i,s):Wo(i,s),o(i),o(s))};const Dr=e=>(t,n)=>{const{selector:o,prehidingSelector:r,content:s}=t;return yr(r),N(o,Vo).then((t=>((e,t,n,o)=>{const r=e.map((e=>o(e,t,n)));return Promise.all(r)})(t,s,n,e))).then((()=>{wr(r)}),(e=>{throw wr(r),e}))},Sr=e=>(""+e).endsWith("px")?e:e+"px";var Or=(e,t,n)=>{const{priority:o,...r}=t;Object.keys(r).forEach((t=>{let n=r[t];"left"!==t&&"top"!==t||(n=Sr(n)),Jo(e,t,n,o)})),n(e)},Tr=(e,t,n)=>{n(e)},Nr=(e,t,n)=>{const{priority:o,...r}=t;Object.keys(r).forEach((t=>{let n=r[t];"width"!==t&&"height"!==t||(n=Sr(n)),Jo(e,t,n,o)})),n(e)};const qr="setHtml",xr="customCode",Mr="setText",Ar="setAttribute",Ur="setImageSource",Lr="setStyle",jr="move",Br="resize",Fr="rearrange",Vr="remove",zr="insertAfter",Hr="insertBefore",_r="replaceHtml",Jr="prependHtml",Qr="appendHtml",Gr="click",Wr="collectInteractions";var Xr=(e,t)=>{if(Lo(e))return((e,t)=>t.matches?t.matches(e):t.msMatchesSelector(e))(e,t);const n=Vo(e);let o=!1;for(let e=0;e<n.length;e+=1)if(n[e]===t){o=!0;break}return o};const Yr="view",$r=e=>e.map((e=>{const{trackingLabel:t,scopeType:n,...o}=e;return o})),Kr=(e,t,n)=>{const{documentElement:o}=document;let r=e,s=0;for(;r&&r!==o;){if(Xr(t,r)){const e=n(t),o={metas:e},r=e.find((e=>e.trackingLabel));r&&(o.label=r.trackingLabel,o.weight=s);const i=e.find((e=>e.scopeType===Yr));return i&&(o.viewName=i.scope,o.weight=s),o}r=r.parentNode,s+=1}return{metas:null}};var Zr=(e,t,n)=>{const o=[];let r,s="",i=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;for(let c=0;c<t.length;c+=1){const{metas:d,label:l,weight:u,viewName:g}=Kr(e,t[c],n);d&&(l&&u<=i&&(s=l,i=u),g&&u<=a&&(r=g,a=u),o.push(...$r(d)))}return{decisionsMeta:(c=o,c.filter(((e,t)=>{const n=JSON.stringify(e);return t===c.findIndex((e=>JSON.stringify(e)===n))}))),propositionActionLabel:s,propositionActionToken:void 0,viewName:r};var c},es=(e=document)=>-1!==e.location.href.indexOf("adobe_authoring_enabled");const ts=(e,t,n,o)=>{if(0===t.length)return;const r={};n.forEach((e=>{r[e]=1}));const s={_experience:{decisioning:{propositions:t,propositionEventType:r}}};o&&(s._experience.decisioning.propositionAction=o),e.mergeXdm(s)},ns=(e,t)=>{e.mergeQuery({personalization:{...t}})};var os=()=>{const e={};return{storeClickMeta:({selector:t,meta:{id:n,scope:o,scopeDetails:r,trackingLabel:s,scopeType:i}})=>{e[t]||(e[t]={}),e[t][n]={scope:o,scopeDetails:r,trackingLabel:s,scopeType:i}},getClickSelectors:()=>Object.keys(e),getClickMetas:t=>e[t]?(e=>Object.keys(e).map((t=>({id:t,...e[t]}))))(e[t]):{}}};const rs=(e,t)=>e===bo&&t===Wr,ss={[wo]:()=>!0,[vo]:()=>!0,[bo]:rs,[Io]:()=>!0,[yo]:()=>!0};var is=({processPropositions:e,createProposition:t,renderedPropositions:n,viewCache:o})=>{const r=({items:e,metadataForScope:t={}})=>{const{actionType:n,selector:o}=t;return e.filter((e=>((e,t)=>"function"==typeof ss[e]&&ss[e](e,t))(e.schema,n))).map((e=>{const{schema:r}=e;return r===vo||rs(r,n)?A(t)?void 0:{...e,schema:rs(r,n)?wo:r,data:{...e.data,selector:o,type:n}}:{...e}})).filter((e=>e))},s=e=>!(e.scope===_t&&e.renderAttempted);return({propositions:i=[],metadata:a={},viewName:c})=>{const d=l();n.concat(d.promise);const u=(({propositions:e,metadata:t})=>e.filter(s).map((e=>{if(v(e.items)){const{id:n,scope:o,scopeDetails:s}=e;return{id:n,scope:o,scopeDetails:s,items:r({items:e.items,metadataForScope:t[e.scope]})}}return e})).filter((e=>v(e.items))))({propositions:i,metadata:a}).map((e=>t(e)));return Promise.resolve().then((()=>c?o.getView(c):[])).then((t=>{const{render:n,returnedPropositions:o}=e([...u,...t]);return n().then(d.resolve),{propositions:o}}))}};var as=e=>{const{selector:t,type:n}=e;return n!==xr||"BODY > *:eq(0)"!==t?e:{...e,selector:"BODY"}};var cs=e=>{const t={...e},{content:n,selector:o}=t;if(!re(r=n)||!r.trim())return t;var r;if(null==o)return t;const s=Vo(o);return sr(s[0],"HEAD")?(t.type=Qr,t.content=(e=>{const t=Ao(e);return R("SCRIPT,LINK,STYLE",t).map((e=>e.outerHTML)).join("")})(n),t):t},ds=({preprocess:e,isPageWideSurface:t})=>(n,o=!0,r=!1)=>{const{id:s,scope:i,scopeDetails:a,items:c=[]}=n,{characteristics:{scopeType:d}={}}=a||{};return{getScope:()=>i,getScopeType:()=>i===_t||t(i)?"page":d===Yr?Yr:"proposition",getItems(){return c.map((t=>((t,n)=>{const{id:o,schema:r,data:s,characteristics:{trackingLabel:i}={}}=t,a=s?s.type:void 0,c=e(s);return{getId:()=>o,getSchema:()=>r,getSchemaType:()=>a,getData:()=>c,getProposition:()=>n,getTrackingLabel:()=>i,getOriginalItem:()=>t,toString:()=>JSON.stringify(t),toJSON:()=>t}})(t,this)))},getNotification:()=>({id:s,scope:i,scopeDetails:a}),getId:()=>s,toJSON:()=>n,shouldSuppressDisplay:()=>r,addToReturnValues(e,t,r,s){o&&(e.push({...n,items:r.map((e=>e.getOriginalItem())),renderAttempted:s}),s||t.push({...n,items:r.map((e=>e.getOriginalItem()))}))}}},ls=()=>({render:ie,setRenderAttempted:!0,includeInNotification:!0});const us="always",gs="never",ps="decoratedElementsOnly",ms=[us,gs,ps],fs="data-aep-interact-id",hs="data-aep-click-label";let ys=0;const ws=(e,t,n,o,r,s,i,a)=>{const{scopeDetails:c={}}=i,{decisionProvider:d}=c;return((e,t)=>!!e&&!!e[t]&&[us,ps].includes(e[t]))(e,d)||t===Gr?e=>{if(!e.tagName)return;const t=(c=_o(e,fs))?parseInt(c,10):++ys;var c;a(n,o,s,i,t),Ho(e,fs,t),r&&!_o(e,hs)&&Ho(e,hs,r)}:ie};var vs=({modules:e,logger:t,storeInteractionMeta:n,storeClickMeta:o,autoCollectPropositionInteractions:r})=>s=>{const{type:i,selector:a}=s.getData()||{};if(!i)return t.warn("Invalid DOM action data: missing type.",s.getData()),{setRenderAttempted:!1,includeInNotification:!1};if(i===Gr)return a?(o({selector:a,meta:{...s.getProposition().getNotification(),trackingLabel:s.getTrackingLabel(),scopeType:s.getProposition().getScopeType()}}),{setRenderAttempted:!0,includeInNotification:!1}):(t.warn("Invalid DOM action data: missing selector.",s.getData()),{setRenderAttempted:!1,includeInNotification:!1});if(!e[i])return t.warn("Invalid DOM action data: unknown type.",s.getData()),{setRenderAttempted:!1,includeInNotification:!1};const c=ws(r,i,s.getProposition().getId(),s.getId(),s.getTrackingLabel(),s.getProposition().getScopeType(),s.getProposition().getNotification(),n);return{render:()=>e[i](s.getData(),c),setRenderAttempted:!0,includeInNotification:!0}},bs=({modules:e,logger:t,storeInteractionMeta:n,autoCollectPropositionInteractions:o})=>r=>{const{type:s,selector:i}=r.getData()||{};if(!i||!s)return{setRenderAttempted:!1,includeInNotification:!1};if(!e[s])return t.warn("Invalid HTML content data",r.getData()),{setRenderAttempted:!1,includeInNotification:!1};const a=ws(o,s,r.getProposition().getId(),r.getId(),r.getTrackingLabel(),r.getProposition().getScopeType(),r.getProposition().getNotification(),n);return{render:()=>e[s](r.getData(),a),setRenderAttempted:!0,includeInNotification:!0}};const Cs="BODY";var Is=({logger:e,executeRedirect:t,collect:n})=>o=>{const{content:r}=o.getData()||{};if(!r)return e.warn("Invalid Redirect data",o.getData()),{};return{render:()=>(yr(Cs),n({decisionsMeta:[o.getProposition().getNotification()],documentMayUnload:!0}).then((()=>(e.logOnContentRendering({status:"rendering-redirect",detail:{propositionDetails:o.getProposition().getNotification(),redirect:r},message:"Redirect action "+o.toString()+" executed.",logLevel:"info"}),t(r)))).catch((e=>{throw wr(Cs),e}))),setRenderAttempted:!0,onlyRenderThis:!0}},Es=({schemaProcessors:e,logger:t})=>{const n=(e,n)=>()=>Promise.resolve().then(e).then((()=>(t.enabled&&t.info("Action "+n.toString()+" executed."),n.toJSON()))).catch((e=>{const{message:o,stack:r}=e,s="Failed to execute action "+n.toString()+". "+o+" "+r;t.logOnContentRendering({status:"rendering-failed",detail:{propositionDetails:n.getProposition().getNotification(),item:n.toJSON()},error:e,message:s,logLevel:"warn"})})),o=t=>{const n=e[t.getSchema()];return n?n(t):{}},r=({renderers:e,returnedPropositions:t,returnedDecisions:r,items:s,proposition:i})=>{let a,c,d,l,u=[...e],g=[...t],p=[...r],m=[],f=[],h=[],y=!1,w=!1,b=0;for(;s.length>b;){if(l=s[b],({render:a,setRenderAttempted:c,includeInNotification:d,onlyRenderThis:w}=o(l)),w){g=[],p=[],c?(m=[l],f=[]):(m=[],f=[l]),u=[],h=[a],y=d;break}a&&h.push(n(a,l)),d&&(y=!0),c?m.push(l):f.push(l),b+=1}if(h.length>0){const e=y?i.getNotification():void 0;u.push((()=>(async(e,t)=>{const n=(await Promise.allSettled(e.map((e=>e())))).filter((e=>"fulfilled"===e.status)).map((e=>e.value));if(t&&v(n))return{...t,items:n}})(h,e)))}else y&&u.push((()=>Promise.resolve(i.getNotification())));return m.length>0&&i.addToReturnValues(g,p,m,!0),f.length>0&&i.addToReturnValues(g,p,f,!1),{renderers:u,returnedPropositions:g,returnedDecisions:p,onlyRenderThis:w}};return(e,n=[])=>{let o,s,i,a=[],c=[],d=[],l=0;for(;e.length>l&&(s=e[l],i=s.getItems(),({renderers:a,returnedPropositions:c,returnedDecisions:d,onlyRenderThis:o}=r({renderers:a,returnedPropositions:c,returnedDecisions:d,items:i,proposition:s})),!o);)l+=1;o&&e.forEach(((e,t)=>{t!==l&&e.addToReturnValues(c,d,e.getItems(),!1)})),n.forEach((e=>{e.addToReturnValues(c,d,e.getItems(),!1)}));return{returnedPropositions:c,returnedDecisions:d,render:()=>Promise.all(a.map((e=>e()))).then((e=>{const n=e.filter((e=>e)),o=n.map((e=>{const{id:t,scope:n,scopeDetails:o}=e;return{id:t,scope:n,scopeDetails:o}}));if(v(n)){const e=z(n,(e=>e.scope));t.logOnContentRendering({status:"rendering-succeeded",detail:{...e},message:"Scopes: "+JSON.stringify(e)+" successfully executed.",logLevel:"info"})}return o}))}}};var ks=({processPropositions:e,createProposition:t,notificationHandler:n})=>({renderDecisions:o,propositions:r,event:s,personalization:i={}})=>{if(!o)return Promise.resolve();const{sendDisplayEvent:a=!0}=i,c=s?s.getViewName():void 0,d=(()=>{let e=0;return t=>{const{items:n=[]}=t;return!!n.some((e=>e.schema===Io))&&(e+=1,e>1)}})(),l=r.map((e=>t(e,!0,d(e)))),{render:u,returnedPropositions:g}=e(l),p=n(o,a,c),m=l.reduce(((e,t)=>(e[t.getId()]=t,e)),{});return u().then((e=>{const t=e.filter((e=>!m[e.id].shouldSuppressDisplay())),n=e.filter((e=>m[e.id].shouldSuppressDisplay()));p(t,n)})),Promise.resolve({propositions:g})};const Ps="text/html",Rs="defaultContent",Ds=["content","contentType"],Ss=["mobileParameters","webParameters","html"];var Os=({modules:e,logger:t})=>n=>{const o=n.getData(),r=n.getProposition(),s={...r.getNotification()},i=r.shouldSuppressDisplay();if(!o)return t.warn("Invalid in-app message data: undefined.",o),{};const{type:a=Rs}=o;return e[a]?((e,t)=>{for(let n=0;n<Ds.length;n+=1){const o=Ds[n];if(!Object.prototype.hasOwnProperty.call(e,o))return t.warn("Invalid in-app message data: missing property '"+o+"'.",e),!1}const{content:n,contentType:o}=e;if("application/json"===o)for(let o=0;o<Ss.length;o+=1){const r=Ss[o];if(!Object.prototype.hasOwnProperty.call(n,r))return t.warn("Invalid in-app message data.content: missing property '"+r+"'.",e),!1}return!0})(o,t)?s?{render:()=>i?null:e[a]({...o,meta:s}),setRenderAttempted:!0,includeInNotification:!0}:(t.warn("Invalid in-app message meta: undefined.",s),{}):{}:(t.warn("Invalid in-app message data: unknown type.",o),{})};const Ts=e=>{const t=R("#"+e,document);t&&t.length>0&&q(t[0])};var Ns=e=>(t,n=!1)=>(n?e.location.href=t:e.location.replace(t),new Promise((()=>{})));const qs="alloy-messaging-container",xs="alloy-overlay-container",Ms="alloy-content-iframe",As=()=>[qs,xs].forEach(Ts),Us=(e,t=Ns(window))=>n=>{n.preventDefault(),n.stopImmediatePropagation();const{target:o}=n,r="a"===o.tagName.toLowerCase()?o:o.closest("a");if(!r)return;const{action:s,interaction:i,link:a,label:c,uuid:d}=(e=>{const t={};if(!e||"a"!==e.tagName.toLowerCase())return t;const{href:n}=e;if(!n||!n.startsWith("adbinapp://"))return t;const o=n.split("?"),r=o[0].split("://")[1],s=e.innerText,i=e.getAttribute("data-uuid")||"";let a,c;if(v(o)){const e=de.parse(o[1]);a=e.interaction||"",c=Tn(e.link||"")}return{action:r,interaction:a,link:c,label:s,uuid:i}})(r);e(s,{label:c,id:i,uuid:d,link:a}),"dismiss"===s&&As(),se(a)&&a.length>0&&t(a,!0)},Ls=e=>{const{verticalAlign:t,width:n,horizontalAlign:o,backdropColor:r,height:s,cornerRadius:i,horizontalInset:a,verticalInset:c,uiTakeover:d=!1}=e,l={width:n?n+"%":"100%",backgroundColor:r||"rgba(0, 0, 0, 0.5)",borderRadius:i?i+"px":"0px",border:"none",position:d?"fixed":"relative",overflow:"hidden"};return"left"===o?l.left=a?a+"%":"0":"right"===o?l.right=a?a+"%":"0":"center"===o&&(l.left="50%",l.transform="translateX(-50%)"),"top"===t?l.top=c?c+"%":"0":"bottom"===t?(l.position="fixed",l.bottom=c?c+"%":"0"):"center"===t&&(l.top="50%",l.transform=("center"===o?l.transform+" ":"")+"translateY(-50%)",l.display="flex",l.alignItems="center",l.justifyContent="center"),l.height=s?s+"vh":"100%",l},js=e=>{const{backdropOpacity:t,backdropColor:n}=e;return{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"transparent",opacity:t||.5,backgroundColor:n||"#FFFFFF"}},Bs=["enabled","parentElement","insertionMethod"],Fs=(e={},t)=>{As();const{content:n,contentType:o,mobileParameters:r}=e;let{webParameters:s}=e;if(o!==Ps)return;const i=p("div",{id:qs}),a=((e,t)=>{const n=(new DOMParser).parseFromString(e,Ps),o=n.querySelector("script");o&&o.setAttribute("nonce",Ko());const r=p("iframe",{src:URL.createObjectURL(new Blob([n.documentElement.outerHTML],{type:"text/html"})),id:Ms});return r.addEventListener("load",(()=>{const{addEventListener:e}=r.contentDocument||r.contentWindow.document;e("click",t)})),r})(n,Us(t)),c=p("div",{id:xs});(e=>{if(!e)return!1;const t=Object.keys(e);if(!t.includes(qs))return!1;if(!t.includes(xs))return!1;const n=Object.values(e);for(let e=0;e<n.length;e+=1){if(!gt(n[e],"style"))return!1;if(!gt(n[e],"params"))return!1;for(let t=0;t<Bs.length;t+=1)if(!gt(n[e].params,Bs[t]))return!1}return!0})(s)||(s=(e=>{if(!e)return;const{uiTakeover:t=!1}=e;return{[Ms]:{style:{border:"none",width:"100%",height:"100%"},params:{enabled:!0,parentElement:"#alloy-messaging-container",insertionMethod:"appendChild"}},[qs]:{style:Ls(e),params:{enabled:!0,parentElement:"body",insertionMethod:"appendChild"}},[xs]:{style:js(e),params:{enabled:!0===t,parentElement:"body",insertionMethod:"appendChild"}}}})(r)),s&&((e,t,n,o)=>{[{id:xs,element:o},{id:qs,element:n},{id:Ms,element:e}].forEach((({id:e,element:n})=>{const{style:o={},params:r={}}=t[e];n.style={...n.style,...o};const{parentElement:s="body",insertionMethod:i="appendChild",enabled:a=!0}=r,c=document.querySelector(s);a&&c&&"function"==typeof c[i]&&c[i](n)}))})(a,s,i,c)};var Vs=e=>({defaultContent:t=>((e,t)=>new Promise((n=>{const{meta:o}=e;Fs(e,((e,n)=>{const r={};r[To.INTERACT]=1,-1!==Object.values(To).indexOf(e)&&(r[e]=1),t({decisionsMeta:[o],propositionAction:n,eventType:Ro,propositionEventTypes:Object.keys(r)})})),n({meta:o})})))(t,e)});const zs=e=>{const t=e.find((e=>e.scopeType===Yr));return t?t.scope:void 0};var Hs=(e,t,n)=>{const{interactIds:o,clickLabel:r="",clickToken:s}=(e=>{const{documentElement:t}=document;let n=e;const o=new Set;let r,s;for(;n&&n!==t;){const e=_o(n,fs);e&&o.add(e),r=r||_o(n,hs),s=s||_o(n,"data-aep-click-token"),n=n.parentNode}return{interactIds:[...o],clickLabel:r,clickToken:s}})(e),i=((e,t,n)=>o=>{const{scopeDetails:r={}}=o,{decisionProvider:s}=r;return e[s]===us||e[s]===ps&&(t||n)})(n,r,s);if(0===o.length)return{};const a=t(o).filter(i);return{decisionsMeta:$r(a),propositionActionLabel:r,propositionActionToken:s,viewName:zs(a)}};const _s="AJO",Js="TGT",Qs=({config:e,logger:t,eventManager:n,consent:o})=>{const{targetMigrationEnabled:r,prehidingStyle:s,autoCollectPropositionInteractions:i}=e,a=(({eventManager:e,mergeDecisionsMeta:t})=>({decisionsMeta:n=[],propositionAction:o,documentMayUnload:r=!1,eventType:s=Po,propositionEventTypes:i=[qo(s)],viewName:a})=>{const c=e.createEvent(),d={eventType:s};return a&&(d.web={webPageDetails:{viewName:a}}),v(n)&&t(c,n,i,o),c.mergeXdm(d),r&&c.documentMayUnload(),e.sendEvent(c)})({eventManager:n,mergeDecisionsMeta:ts}),c=(e=>()=>{const t=zo(fr);t&&(e.logOnContentHiding({status:"show-containers",message:"Prehiding style removed to show containers.",logLevel:"info"}),q(t))})(t),d=(e=>t=>{if(!t)return;if(zo(fr))return;const n=Ko(),o={id:fr,...n&&{nonce:n}},r=p(f,o,{textContent:t});e.logOnContentHiding({status:"hide-containers",message:"Prehiding style applied to hide containers.",logLevel:"info"}),g(document.head,r)})(t),{storeInteractionMeta:u,getInteractionMetas:m}=(()=>{const e={},t={};return{storeInteractionMeta:(n,o,r,s,i)=>{i=parseInt(i,10),e[i]||(e[i]={},t[i]={}),t[i][n]||(t[i][n]=new Set),t[i][n].add(o),e[i][n]={...s,scopeType:r}},getInteractionMetas:n=>Array.isArray(n)&&0!==n.length?Object.values(n.map((e=>parseInt(e,10))).reduce(((n,o)=>(Object.keys(e[o]||{}).forEach((r=>{n[r]||(n[r]={proposition:e[o][r],items:new Set}),n[r].items=new Set([...n[r].items,...t[o][r]])})),n)),{})).map((({proposition:e,items:t})=>({...e,items:Array.from(t).map((e=>({id:e})))}))):[]}})(),{storeClickMeta:h,getClickSelectors:y,getClickMetas:w}=os(),b=(({window:e})=>()=>e.location)({window:window}),C={[qr]:Dr(pr),[xr]:Dr(mr),[Mr]:Dr(vr),[Ar]:Dr(kr),[Ur]:Dr(Pr),[Lr]:Dr(Er),[jr]:Dr(Or),[Br]:Dr(Nr),[Fr]:Dr(Rr),[Vr]:Dr(q),[zr]:Dr(Ir),[Hr]:Dr(br),[_r]:Dr(Cr),[Jr]:Dr(mr),[Qr]:Dr(gr),[Wr]:Dr(Tr)},I=(E=[cs,as],e=>e?E.reduce(((e,t)=>({...e,...t(e)})),e):e);var E;const k=ds({preprocess:I,isPageWideSurface:ho}),P=(({createProposition:e})=>{let t=!1,n=Promise.resolve({});const o=(t,n)=>{const o=t[n.toLowerCase()];return o&&o.length>0?o:[e({scope:n,scopeDetails:{characteristics:{scopeType:Yr}},items:[{schema:yo}]},!1)]};return{createCacheUpdate:e=>{const r=l();return t=!0,n=n.then((e=>r.promise.then((t=>({...e,...t}))).catch((()=>e)))),{update(t){const n=t.filter((e=>e.getScope())),s=z(n,(e=>e.getScope().toLowerCase()));return r.resolve(s),e?o(s,e):[]},cancel(){r.reject()}}},getView:e=>n.then((t=>o(t,e))),isInitialized:()=>t}})({createProposition:k}),R=Ns(window),D={[yo]:ls,[wo]:vs({modules:C,logger:t,storeInteractionMeta:u,storeClickMeta:h,autoCollectPropositionInteractions:i}),[vo]:bs({modules:C,logger:t,storeInteractionMeta:u,autoCollectPropositionInteractions:i}),[Co]:Is({logger:t,executeRedirect:R,collect:a}),[Io]:Os({modules:Vs(a),logger:t})},S=Es({schemaProcessors:D,logger:t}),O=(()=>{let e=Promise.resolve([]);return{concat(t){e=e.then((e=>t.then((t=>e.concat(t))).catch((()=>e))))},clear(){const t=e;return e=Promise.resolve([]),t}}})(),T=((e,t)=>(n,o,r)=>{if(!n)return()=>{};if(!o){const e=l();return t.concat(e.promise),e.resolve}return(t=[],n=[])=>{v(t)&&e({decisionsMeta:t,viewName:r}),v(n)&&e({decisionsMeta:n,eventType:Oo,propositionAction:{reason:"Conflict"},viewName:r})}})(a,O),N=(({logger:e,prehidingStyle:t,showContainers:n,hideContainers:o,mergeQuery:r,processPropositions:s,createProposition:i,notificationHandler:a,consent:c})=>({cacheUpdate:d,personalizationDetails:l,event:u,onResponse:g})=>{const{state:p,wasSet:m}=c.current();"out"===p&&m||(l.isRenderDecisions()?o(t):n()),r(u,l.createQueryDetails());const f=a(l.isRenderDecisions(),l.isSendDisplayEvent(),l.getViewName());g((({response:t})=>{const o=t.getPayloadsByType("personalization:decisions");v(o)||e.logOnContentRendering({status:"no-offers",message:"No offers were returned.",logLevel:"info",detail:{query:l.createQueryDetails()}});const r=o.map((e=>i(e))),{page:a=[],view:c=[],proposition:u=[]}=z(r,(e=>e.getScopeType())),g=d.update(c);let p,m,h;return l.isRenderDecisions()?(({render:p,returnedPropositions:m,returnedDecisions:h}=s([...a,...g],u)),v(a)&&e.logOnContentRendering({status:"rendering-started",message:"Started rendering propositions for page-wide scope.",logLevel:"info",detail:{scope:_t,propositions:a.map((e=>e.toJSON()))}}),v(g)&&e.logOnContentRendering({status:"rendering-started",message:"Rendering propositions started for view scope - "+l.getViewName()+".",logLevel:"info",detail:{scope:l.getViewName(),propositions:g.map((e=>e.toJSON()))}}),p().then(f),n()):({returnedPropositions:m,returnedDecisions:h}=s([],[...a,...g,...u])),{propositions:m,decisions:h}}))})({prehidingStyle:s,showContainers:c,hideContainers:d,mergeQuery:ns,processPropositions:S,createProposition:k,notificationHandler:T,consent:o,logger:t}),x=(({mergeDecisionsMeta:e,collectInteractions:t,collectClicks:n,getInteractionMetas:o,getClickMetas:r,getClickSelectors:s,autoCollectPropositionInteractions:i})=>({event:a,clickedElement:c})=>{const d=[];let l,u,g;if([t(c,o,i),n(c,s(),r)].forEach((({decisionsMeta:e,propositionActionLabel:t,propositionActionToken:n,viewName:o})=>{Array.prototype.push.apply(d,e),!l&&t&&(l=t),!u&&n&&(u=n),!g&&o&&(g=o)})),v(d)){const t={eventType:Ro};g&&(t.web={webPageDetails:{viewName:g}}),a.mergeXdm(t),e(a,d,[To.INTERACT],((e,t)=>{if(!t&&!e)return;const n={};return e&&(n.label=e),t&&(n.tokens=[t]),n})(l,u))}})({mergeDecisionsMeta:ts,collectInteractions:Hs,collectClicks:Zr,getInteractionMetas:m,getClickMetas:w,getClickSelectors:y,autoCollectPropositionInteractions:i}),M=(({processPropositions:e,viewCache:t,logger:n})=>({personalizationDetails:o,onResponse:r})=>{let s,i;const a=o.getViewName();return r((()=>({propositions:s,decisions:i}))),t.getView(a).then((t=>{let r;return o.isRenderDecisions()?(({render:r,returnedPropositions:s,returnedDecisions:i}=e(t)),n.logOnContentRendering({status:"rendering-started",message:"Started rendering propositions for view scope - "+a+".",logLevel:"info",detail:{scope:a,propositions:t.map((e=>e.toJSON()))}}),r()):(({returnedPropositions:s,returnedDecisions:i}=e([],t)),[])}))})({processPropositions:S,viewCache:P,logger:t}),A=is({processPropositions:S,createProposition:k,renderedPropositions:O,viewCache:P}),U=(({targetMigrationEnabled:e})=>e?e=>{e.getPayload().mergeMeta({target:{migration:!0}})}:ie)({targetMigrationEnabled:r}),L=ks({processPropositions:S,createProposition:k,notificationHandler:T}),j=(({showContainers:e,consent:t})=>()=>{const{state:n,wasSet:o}=t.current();n===kt&&o?e():t.awaitConsent().catch(e)})({showContainers:c,consent:o});return Mo({getPageLocation:b,logger:t,fetchDataHandler:N,viewChangeHandler:M,onClickHandler:x,isAuthoringModeEnabled:es,mergeQuery:ns,viewCache:P,showContainers:c,applyPropositions:A,setTargetMigration:U,mergeDecisionsMeta:ts,renderedPropositions:O,onDecisionHandler:L,handleConsentFlicker:j})};Qs.namespace="Personalization";const Gs=ms.map((e=>dt(e)));Qs.configValidators=gt({prehidingStyle:pt().nonEmpty(),targetMigrationEnabled:at().default(!1),autoCollectPropositionInteractions:gt({[_s]:rt(Gs).default(us),[Js]:rt(Gs).default(gs)}).default({[_s]:us,[Js]:gs}).noUnknownFields()}),gt({personalizationStorageEnabled:at().default(!1)}),gt({streamingMedia:gt({channel:pt().nonEmpty().required(),playerName:pt().nonEmpty().required(),appVersion:pt(),mainPingInterval:lt().minimum(10).maximum(50).default(10),adPingInterval:lt().minimum(1).maximum(10).default(10)}).noUnknownFields()}),(({components:e})=>{const t=window.__alloyNS;t&&t.forEach((t=>{const n=wt({console:Qn,locationSearch:window.location.search,createLogger:Ht,instanceName:t,createNamespacedStorage:_n,getMonitors:Xn}),o=(e=>([t,n,[o,r]])=>{e(o,r).then(t,n)})(no({instanceName:t,logController:n,components:e})),r=window[t].q;r.push=o,n.logger.logOnInstanceCreated({instance:o}),r.forEach(o)}))})({components:[Qs]})}();
